
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta
            name="description"
            content="Documentation for SMAPIv3"
        >
    <title>SMAPIv3 Xapi Storage Interface</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-c9d8fa83.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-953e3353.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-b12a2749.js"></script>

    <script>
      $(function() { setupCodeCopy(); });
    </script>
  </head>

  <body class="index" data-languages="[&quot;json&quot;,&quot;ocaml&quot;,&quot;python&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-1e815a84.png" class="logo" alt="" />
        <div class="lang-selector">
              <a href="#" data-language-name="json">json</a>
              <a href="#" data-language-name="ocaml">ocaml</a>
              <a href="#" data-language-name="python">python</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#introduction-who-is-this-for" class="toc-h2 toc-link" data-title="Who Is This For?">Who Is This For?</a>
                  </li>
                  <li>
                    <a href="#introduction-status-of-this-documentation" class="toc-h2 toc-link" data-title="Status of This Documentation">Status of This Documentation</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#learn" class="toc-h1 toc-link" data-title="Learn">Learn</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#learn-features" class="toc-h2 toc-link" data-title="Features">Features</a>
                  </li>
                  <li>
                    <a href="#learn-concepts" class="toc-h2 toc-link" data-title="Concepts">Concepts</a>
                  </li>
                  <li>
                    <a href="#learn-architecture" class="toc-h2 toc-link" data-title="Architecture">Architecture</a>
                  </li>
                  <li>
                    <a href="#learn-frequently-asked-questions" class="toc-h2 toc-link" data-title="Frequently Asked Questions">Frequently Asked Questions</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#develop" class="toc-h1 toc-link" data-title="Develop">Develop</a>
          </li>
          <li>
            <a href="#plugin" class="toc-h1 toc-link" data-title="plugin">plugin</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#plugin-type-definitions" class="toc-h2 toc-link" data-title="Type definitions">Type definitions</a>
                  </li>
                  <li>
                    <a href="#plugin-interface-plugin" class="toc-h2 toc-link" data-title="Interface: Plugin">Interface: <code>Plugin</code></a>
                  </li>
                  <li>
                    <a href="#plugin-method-query" class="toc-h2 toc-link" data-title="Method: query">Method: <code>query</code></a>
                  </li>
                  <li>
                    <a href="#plugin-method-ls" class="toc-h2 toc-link" data-title="Method: ls">Method: <code>ls</code></a>
                  </li>
                  <li>
                    <a href="#plugin-method-diagnostics" class="toc-h2 toc-link" data-title="Method: diagnostics">Method: <code>diagnostics</code></a>
                  </li>
                  <li>
                    <a href="#plugin-errors" class="toc-h2 toc-link" data-title="Errors">Errors</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#datapath" class="toc-h1 toc-link" data-title="datapath">datapath</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#datapath-type-definitions" class="toc-h2 toc-link" data-title="Type definitions">Type definitions</a>
                  </li>
                  <li>
                    <a href="#datapath-interface-datapath" class="toc-h2 toc-link" data-title="Interface: Datapath">Interface: <code>Datapath</code></a>
                  </li>
                  <li>
                    <a href="#datapath-method-open" class="toc-h2 toc-link" data-title="Method: open">Method: <code>open</code></a>
                  </li>
                  <li>
                    <a href="#datapath-method-attach" class="toc-h2 toc-link" data-title="Method: attach">Method: <code>attach</code></a>
                  </li>
                  <li>
                    <a href="#datapath-method-activate" class="toc-h2 toc-link" data-title="Method: activate">Method: <code>activate</code></a>
                  </li>
                  <li>
                    <a href="#datapath-method-activate_readonly" class="toc-h2 toc-link" data-title="Method: activate_readonly">Method: <code>activate_readonly</code></a>
                  </li>
                  <li>
                    <a href="#datapath-method-deactivate" class="toc-h2 toc-link" data-title="Method: deactivate">Method: <code>deactivate</code></a>
                  </li>
                  <li>
                    <a href="#datapath-method-detach" class="toc-h2 toc-link" data-title="Method: detach">Method: <code>detach</code></a>
                  </li>
                  <li>
                    <a href="#datapath-method-close" class="toc-h2 toc-link" data-title="Method: close">Method: <code>close</code></a>
                  </li>
                  <li>
                    <a href="#datapath-interface-data" class="toc-h2 toc-link" data-title="Interface: Data">Interface: <code>Data</code></a>
                  </li>
                  <li>
                    <a href="#datapath-method-copy" class="toc-h2 toc-link" data-title="Method: copy">Method: <code>copy</code></a>
                  </li>
                  <li>
                    <a href="#datapath-method-mirror" class="toc-h2 toc-link" data-title="Method: mirror">Method: <code>mirror</code></a>
                  </li>
                  <li>
                    <a href="#datapath-method-stat" class="toc-h2 toc-link" data-title="Method: stat">Method: <code>stat</code></a>
                  </li>
                  <li>
                    <a href="#datapath-method-cancel" class="toc-h2 toc-link" data-title="Method: cancel">Method: <code>cancel</code></a>
                  </li>
                  <li>
                    <a href="#datapath-method-destroy" class="toc-h2 toc-link" data-title="Method: destroy">Method: <code>destroy</code></a>
                  </li>
                  <li>
                    <a href="#datapath-method-ls" class="toc-h2 toc-link" data-title="Method: ls">Method: <code>ls</code></a>
                  </li>
                  <li>
                    <a href="#datapath-errors" class="toc-h2 toc-link" data-title="Errors">Errors</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#volume" class="toc-h1 toc-link" data-title="volume">volume</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#volume-type-definitions" class="toc-h2 toc-link" data-title="Type definitions">Type definitions</a>
                  </li>
                  <li>
                    <a href="#volume-interface-sr" class="toc-h2 toc-link" data-title="Interface: SR">Interface: <code>SR</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-probe" class="toc-h2 toc-link" data-title="Method: probe">Method: <code>probe</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-create" class="toc-h2 toc-link" data-title="Method: create">Method: <code>create</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-attach" class="toc-h2 toc-link" data-title="Method: attach">Method: <code>attach</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-detach" class="toc-h2 toc-link" data-title="Method: detach">Method: <code>detach</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-destroy" class="toc-h2 toc-link" data-title="Method: destroy">Method: <code>destroy</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-stat" class="toc-h2 toc-link" data-title="Method: stat">Method: <code>stat</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-set_name" class="toc-h2 toc-link" data-title="Method: set_name">Method: <code>set_name</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-set_description" class="toc-h2 toc-link" data-title="Method: set_description">Method: <code>set_description</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-ls" class="toc-h2 toc-link" data-title="Method: ls">Method: <code>ls</code></a>
                  </li>
                  <li>
                    <a href="#volume-interface-volume" class="toc-h2 toc-link" data-title="Interface: Volume">Interface: <code>Volume</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-create" class="toc-h2 toc-link" data-title="Method: create">Method: <code>create</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-snapshot" class="toc-h2 toc-link" data-title="Method: snapshot">Method: <code>snapshot</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-clone" class="toc-h2 toc-link" data-title="Method: clone">Method: <code>clone</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-copy" class="toc-h2 toc-link" data-title="Method: copy">Method: <code>copy</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-destroy" class="toc-h2 toc-link" data-title="Method: destroy">Method: <code>destroy</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-set_name" class="toc-h2 toc-link" data-title="Method: set_name">Method: <code>set_name</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-set_description" class="toc-h2 toc-link" data-title="Method: set_description">Method: <code>set_description</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-set" class="toc-h2 toc-link" data-title="Method: set">Method: <code>set</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-unset" class="toc-h2 toc-link" data-title="Method: unset">Method: <code>unset</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-resize" class="toc-h2 toc-link" data-title="Method: resize">Method: <code>resize</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-stat" class="toc-h2 toc-link" data-title="Method: stat">Method: <code>stat</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-compare" class="toc-h2 toc-link" data-title="Method: compare">Method: <code>compare</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-similar_content" class="toc-h2 toc-link" data-title="Method: similar_content">Method: <code>similar_content</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-enable_cbt" class="toc-h2 toc-link" data-title="Method: enable_cbt">Method: <code>enable_cbt</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-disable_cbt" class="toc-h2 toc-link" data-title="Method: disable_cbt">Method: <code>disable_cbt</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-data_destroy" class="toc-h2 toc-link" data-title="Method: data_destroy">Method: <code>data_destroy</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-list_changed_blocks" class="toc-h2 toc-link" data-title="Method: list_changed_blocks">Method: <code>list_changed_blocks</code></a>
                  </li>
                  <li>
                    <a href="#volume-method-compose" class="toc-h2 toc-link" data-title="Method: compose">Method: <code>compose</code></a>
                  </li>
                  <li>
                    <a href="#volume-errors" class="toc-h2 toc-link" data-title="Errors">Errors</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#task" class="toc-h1 toc-link" data-title="task">task</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#task-type-definitions" class="toc-h2 toc-link" data-title="Type definitions">Type definitions</a>
                  </li>
                  <li>
                    <a href="#task-interface-task" class="toc-h2 toc-link" data-title="Interface: Task">Interface: <code>Task</code></a>
                  </li>
                  <li>
                    <a href="#task-method-stat" class="toc-h2 toc-link" data-title="Method: stat">Method: <code>stat</code></a>
                  </li>
                  <li>
                    <a href="#task-method-cancel" class="toc-h2 toc-link" data-title="Method: cancel">Method: <code>cancel</code></a>
                  </li>
                  <li>
                    <a href="#task-method-destroy" class="toc-h2 toc-link" data-title="Method: destroy">Method: <code>destroy</code></a>
                  </li>
                  <li>
                    <a href="#task-method-ls" class="toc-h2 toc-link" data-title="Method: ls">Method: <code>ls</code></a>
                  </li>
                  <li>
                    <a href="#task-errors" class="toc-h2 toc-link" data-title="Errors">Errors</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='https://github.com/xapi-project/xapi-storage'>Source Code of SMAPIv3 Interface</a></li>
            <li><a href='https://github.com/xapi-project/xapi-storage/tree/slate'>Source Code of Website</a></li>
            <li><a href='https://github.com/slatedocs/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>The SMAPIv3 storage interface provides an easy way to connect <a href="https://github.com/xapi-project/xen-api">xapi</a> to any
storage type.</p>
<h2 id='introduction-who-is-this-for'>Who Is This For?</h2>
<p><img src="images/your-bit-here-4b4d8257.svg" alt="Your bit here" /></p>

<p>This is for anyone who has a storage system which is not supported by xapi
out-of-the-box.</p>

<p>This is also for anyone who wants to manage their storage in a customized way.
If you can make your volumes appear as Linux block devices or you can refer to
the volumes via URIs of the form <code>iscsi://</code>,  <code>nfs://</code>,  or <code>rbd://</code>, then this
documentation is for you.</p>

<p><strong>No Xapi or Xen specific knowledge is required.</strong></p>
<h2 id='introduction-status-of-this-documentation'>Status of This Documentation</h2>
<p>This documentation is a draft intended for discussion, which happens through
the <a href="https://github.com/xapi-project/xapi-storage/issues">issues on GitHub</a>.</p>
<h1 id='learn'>Learn</h1><h2 id='learn-features'>Features</h2>
<p>The xapi storage interface supports the following features:</p>

<ul>
<li>Storage Repositories: collections of Volumes on the same storage substrate</li>
<li>Volumes may be created, cloned, snapshotted, queried, attached to and
detached from VMs</li>
<li>Storage Repositories can be incrementally probed; for example given only an
iSCSI target portal, the IQNs and then the LUNs can be discovered.</li>
<li>Everything is named by URIs, where the scheme describes the protocol used to
access the data (e.g. file, iscsi)</li>
<li>Implementations expose capabilities and these are reported via the XenAPI</li>
<li>Dynamic properties (such as space utilisation, I/O bandwidth and latency) can
be exposed as &quot;datasources&quot; which are compatible with the xapi toolstack RRD
framework.</li>
<li>The storage implementation can be used to store the xapi HA statefile and
database redo logs</li>
<li>If the storage implementation supports fast clone, then it will work with the
xapi &quot;clone on boot&quot; feature</li>
</ul>
<h2 id='learn-concepts'>Concepts</h2>
<p>When a virtual machine looks at its disk, it sees something which looks like a
real physical disk. This is an illusion. In reality the bytes of data written
to the &quot;virtual disk&quot; probably reside in a file in a filesystem or in a logical
volume on some physical storage system that the VM cannot see.</p>

<p>We call the real physical storage system a <strong>Storage Repository</strong> (SR).</p>

<p>We call the virtual disks within the SR <strong>volumes</strong>.</p>
<h3 id='learn-concepts-manipulating-volumes'>Manipulating volumes</h3>
<p>When a VM is installed, a volume will be created. Typically this volume will be
deleted when the VM is uninstalled. The Xapi toolstack doesn&#39;t know how to
manipulate volumes on your storage system directly; instead it delegates to
&quot;Volume plugins&quot;: implementation-specific plugins which know how to talk the
storage-specific APIs. These volume plugins can be anything from simple scripts
in domain 0 to sophisticated services running somewhere on the network.</p>

<p>Consider for example a system using Linux LVM, where individual LVs are mapped
to VMs as virtual disks. The volume plugin for LVM could implement the
<code>Volume.create</code> API by simply calling</p>

<p><code>lvcreate -n name -L 64GiB -Z n</code></p>

<p>Consider another example where volumes are simple sparse files stored on an NFS
share. The volume plugin could implement the <code>Volume.create</code> API by simply
calling:</p>

<p><code>dd if=/dev/zero of=disk.name count=1 skip=64G</code></p>
<h3 id='learn-concepts-connecting-volumes-to-vms'>Connecting volumes to VMs</h3>
<p>VMs running on the Xen hypervisor use special shared-memory protocols to access
their disks and network interfaces. There are several implementations of these
protocols including:</p>

<ul>
<li>the <a href="http://lxr.free-electrons.com/source/drivers/block/xen-blkback/blkback.c">Linux
xen-blkback</a>
kernel module</li>
<li>the <a href="https://github.com/freebsd/freebsd/blob/master/sys/dev/xen/blkback/blkback.c">FreeBSD
blkback</a>
driver</li>
<li>the <a href="https://github.com/qemu/qemu/blob/master/hw/xen/xen_backend.c">QEMU
qdisk</a>
userspace implementation</li>
<li>the <a href="http://xenserver.org/discuss-virtualization/virtualization-blog/entry/tapdisk3.html">XenServer
tapdisk3</a>
userspace implementation</li>
<li>the <a href="https://github.com/mirage/mirage-block-xen">MirageOS</a> userspace and
kernelspace implementation</li>
</ul>

<p>With so many implementations to choose from, which one should we use for a
given volume? This decision - and how to configure the implementation for
maximum performance - is the job of the Datapath plugin.</p>
<h3 id='learn-concepts-disks-as-uris'>Disks as URIs</h3>
<p>Every volume has one or more URIs, which describe how to access the data within
the volume. Examples include:</p>

<ul>
<li><code>file:///local/block/device</code> - a local file or block device</li>
<li><code>nfs://server/export/path/file.qcow2</code> - a remote NFS server exporting a
.qcow2 format file</li>
<li><code>smb://server/export/path/file.vhd</code> - a remote CIFS server exporting a .vhd
format file</li>
<li><code>rbd://pool/volume</code> - a volume in a Ceph storage pool</li>
<li><code>iscsi://target/lun</code> - a LUN on an iSCSI array</li>
</ul>

<p>The Xapi toolstack takes the list of URIs provided by the Volume plugin and
creates a connection between the VM and the disk. Xapi chooses a &quot;Datapath
plugin&quot; based on the URI scheme. The Datapath plugin returns Xen-specific
connection details, including choice of backend (kernel blkback or userspace
qemu) and caching options.</p>
<h2 id='learn-architecture'>Architecture</h2>
<p>The system is divided into two parts, intended for people with different
expertise:</p>

<ol>
<li>Volume Plugin: this is the storage control-plane. Xapi delegates Volume
manipulation requests to these plugins, which know how to operate on the
physical storage which could be anything from an NFS/CIFS server, an iSCSI
target or a Ceph deployment. <strong>No virtualisation knowledge is required to
write a Volume Plugin.</strong> The volume plugin do not perform I/O directly,
instead they associate volumes with URIs which encode a particular method
for accessing the disk data. For example an NFS plugin could expose URIs of
the form <code>nfs://server/path/file</code></li>
<li>Datapath Plugin: this is the storage data-plane. This is Xen-specific code
which chooses the best way to connect VMs to individual disks. <strong>Xen expertise
is needed to write a datapath plugin.</strong> Note that this code doesn&#39;t know about
volumes; it only knows about specific volume access protocols such as NFS,
iSCSI and RBD.</li>
</ol>
<h3 id='learn-architecture-volume-plugins'>Volume Plugins</h3>
<p>Clients such as <a href="http://www.openstack.org/">OpenStack</a>, <a href="http://cloudstack.apache.org/">CloudStack</a>, <a href="https://github.com/xenserver/xenadmin">XenCenter</a> and <a href="https://xen-orchestra.com/">Xen Orchestra</a>
create VMs and virtual disks by sending XenAPI requests to Xapi. Xapi doesn&#39;t
know how to manipulate storage directly, so it delegates storage operations to
a <strong>Volume Plugin</strong>. Each &quot;Storage Repository&quot; is associated with exactly one
Volume Plugin. These plugins know how to</p>

<ul>
<li>create volumes;</li>
<li>destroy volumes;</li>
<li>snapshot volumes;</li>
<li>clone volumes; and</li>
<li>list the ways in which a volume may be accessed.</li>
</ul>

<p>The following diagram shows a XenAPI client sending a VDI.create request
causing Xapi to send a Volume.create request to a specific plugin:</p>

<p><img src="images/arch-vol-create-67785664.svg" alt="Diagram showing a XenAPI client sending a VDI.create request causing Xapi to
send a Volume.create request to a plugin." /></p>
<h3 id='learn-architecture-datapath-plugins'>Datapath Plugins</h3>
<p>The following diagram shows a XenAPI client sending a VM.start request. Xapi
calls <code>Volume.stat</code> to list the available access methods for the VM&#39;s disks. The
Ceph Volume Plugin returns a URL of the form <code>rbd://server/pool</code> so Xapi consults
its &quot;rbd&quot; Datapath plugin and asks &quot;how should I connect this datapath to the
VM?&quot;. The datapath plugin tells Xapi to use QEMU qdisk&#39;s built-in support for
RBD via librados, so Xapi tells libxl to set this up.</p>

<p><img src="images/arch-vm-start-5dbff0c3.svg" alt="Diagram showing a XenAPI client sending a VM.start request." /></p>
<h2 id='learn-frequently-asked-questions'>Frequently Asked Questions</h2>
<p>How Do I...</p>
<h3 id='learn-frequently-asked-questions-test-my-code'>Test my code?</h3>
<blockquote>
<p>The OCaml and python generated code includes a convenient command-line parser
so if you write:</p>
</blockquote>
<div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">module</span> <span class="nc">Cmds</span> <span class="o">=</span> <span class="nn">Xapi_storage</span><span class="p">.</span><span class="nn">Control</span><span class="p">.</span><span class="nc">Sr</span><span class="p">(</span><span class="nn">Cmdlinergen</span><span class="p">.</span><span class="nc">Gen</span> <span class="bp">()</span><span class="p">)</span>

<span class="nn">Cmdliner</span><span class="p">.</span><span class="nn">Term</span><span class="p">.</span><span class="n">eval_choice</span> <span class="n">default_cmd</span> <span class="p">(</span><span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="p">(</span><span class="k">fun</span> <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span> <span class="n">rpc</span><span class="p">)</span> <span class="p">(</span><span class="nn">Cmds</span><span class="p">.</span><span class="n">implementation</span> <span class="bp">()</span><span class="p">))</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">class</span> <span class="nc">Implementation</span><span class="p">(</span><span class="n">xapi</span><span class="p">.</span><span class="n">volume</span><span class="p">.</span><span class="n">SR_skeleton</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="n">curl</span> <span class="s">"http://example.com/api/kittens/2"</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">xapi</span><span class="p">.</span><span class="n">volume</span><span class="p">.</span><span class="n">SR_commandline</span><span class="p">(</span><span class="n">Implementation</span><span class="p">())</span>
    <span class="n">cmd</span><span class="p">.</span><span class="n">attach</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p>You&#39;ll be able to run the command like this:</p>
</blockquote>
<div class="highlight"><pre class="highlight plaintext"><code>$ ./SR.attach
usage: SR.attach [-h] [-j] dbg uri
SR.attach: error: too few arguments

$ ./SR.attach -h
usage: SR.attach [-h] [-j] dbg uri

[attach uri]: attaches the SR to the local host. Once an SR is attached then
volumes may be manipulated.

positional arguments:
  dbg         Debug context from the caller
  uri         The Storage Repository URI

optional arguments:
  -h, --help  show this help message and exit
  -j, --json  Read json from stdin, print json to stdout
</code></pre></div>
<p>Although it&#39;s not enforced by the interface, plugin implementations should
avoid interacting with the toolstack so that they can be easily tested in
isolation.</p>
<h3 id='learn-frequently-asked-questions-report-dynamic-properties-like-space-consumption'>Report dynamic properties like space consumption?</h3>
<p>Dynamic properties like space consumption, bandwidth or latency should be
exposed as &quot;datasources&quot;. The SR.stat function should return a list of URIs
pointing at these in &quot;xenostats&quot; format. The toolstack will hook up these
datasources to the <a href="https://github.com/xapi-project/xcp-rrdd">xcp-rrdd</a> daemon which will record history. XenAPI clients
can then use the <a href="http://xapi-project.github.io/xen-api/metrics.html">RRD API</a> to fetch the data, draw graphs etc.</p>
<h3 id='learn-frequently-asked-questions-expose-backend-specific-functions'>Expose backend-specific functions?</h3>
<p>curl &quot;http://example.com/api/kittens/2&quot;
  -X DELETE</p>

<p>The SMAPIv3 is intended to be a <em>generic</em> API. Before extending the SMAPIv3
itself, first ask the question: would this make sense for 3 completely
different storage stacks (e.g. consider Ceph, LVM over iSCSI and gfs2). If the
concept is actually general then propose an SMAPIv3 update via a <a href="https://github.com/xapi-project/xapi-storage/pulls">pull
request</a>. If the concept
is actually backend-specific then consider adding a new <a href="http://xapi-project.github.io/devguide/howtos/add-api-extension.html">XenAPI extension</a> for it
and name the API appropriately (e.g. &quot;LVHD.foo&quot;).</p>
<h3 id='learn-frequently-asked-questions-call-xapi'>Call <a href="https://github.com/xapi-project/xen-api">xapi</a>?</h3>
<p>Nothing in the interface prevents you from making RPC calls to xapi or other
toolstack components, however doing so will make it more difficult to test your
component in isolation.</p>

<p>In the past, a common reason to call xapi was to store data in the xapi
database, for example the &quot;sm-config&quot; fields. This was unreliable because</p>

<ul>
<li>The &quot;sm-config&quot; key,value pairs can disappear, for example if the SR is
forgotten and then re-attached.</li>
<li>The &quot;sm-config&quot; key,value pairs may be duplicated over VDI.clone (or not):
the exact behaviour was never defined.</li>
<li>If the storage is itself reverted to a previous point in time (imagine an
SR-level snapshot), then the &quot;sm-config&quot; keys, value pairs will not be
reverted.</li>
</ul>

<p>It is strongly recommended to store all storage-related state on the storage
medium. This ensures that the metadata has a &quot;shared fate&quot; with the data: if
data is restored from backup, reverted to a snapshot, then so is the metadata.</p>
<h3 id='learn-frequently-asked-questions-tie-my-cluster-to-the-xapi-pool'>Tie my cluster to the <a href="https://github.com/xapi-project/xen-api">xapi</a> Pool?</h3>
<p>Ideally a storage cluster would be managed separately from a xapi pool, with
it&#39;s own configuration and monitoring interfaces. The storage cluster could be
very large (consider Ceph-style scale-out) while the xapi pool is designed to
remain within a rack.</p>

<p>In the past, a common reason to tie a storage cluster to the xapi pool was to
piggyback on the xapi notions of a single pool master, HA and inter-host
authenticated RPC mechanisms to co-ordinate activities sych as vhd coalescing.
If it is still necessary to tie a storage cluster to a xapi pool then the
storage implementation should launch it&#39;s own &quot;pool monitor&quot; service which
could use the xapi pool APIs to track host membership and master status. Note:
this might require adding new capabilities to xapi&#39;s pool APIs, but they should
not be part of the storage API itself.</p>

<p>Note: in the case where a particular storage implementation requires a
particular HA cluster stack to be running, this can be declared in the
<code>Plugin.query</code> call.</p>
<h1 id='develop'>Develop</h1>
<p>Below you can find the SMAPIv3 API Reference:</p>
<h1 id='plugin'>plugin</h1>
<p>The xapi toolstack expects all plugins to support a basic query interface. This means that if you plan to implement both, a volume and a datapath plugin, make sure that both implement the query interface.</p>
<h2 id='plugin-type-definitions'>Type definitions</h2><h3 id='plugin-type-definitions-query_result'>query_result</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"required_cluster_stack"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"required_cluster_stack"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="s2">"configuration"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="nl">"features"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"features"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"required_api_version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"required_api_version"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"version"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"copyright"</span><span class="p">:</span><span class="w"> </span><span class="s2">"copyright"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"vendor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vendor"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"plugin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"plugin"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>query_result</code> = <code>struct { ... }</code>
Properties of this implementation.</p>
<h4 id='plugin-type-definitions-query_result-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>plugin</td>
<td>string</td>
<td>Plugin name, used in the XenAPI as SR.type.</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Short name.</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Description.</td>
</tr>
<tr>
<td>vendor</td>
<td>string</td>
<td>Entity (e.g. company, project, group) which produced this implementation.</td>
</tr>
<tr>
<td>copyright</td>
<td>string</td>
<td>Copyright.</td>
</tr>
<tr>
<td>version</td>
<td>string</td>
<td>Version.</td>
</tr>
<tr>
<td>required_api_version</td>
<td>string</td>
<td>Minimum required API version.</td>
</tr>
<tr>
<td>features</td>
<td>string list</td>
<td>Features supported by this plugin.</td>
</tr>
<tr>
<td>configuration</td>
<td>(string * string) list</td>
<td>Key/description pairs describing required device_config parameters.</td>
</tr>
<tr>
<td>required_cluster_stack</td>
<td>string list</td>
<td>The plugin requires one of these cluster stacks to be active.</td>
</tr>
</tbody></table>
<h3 id='plugin-type-definitions-srs'>srs</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"srs"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[]</span><span class="w">
</span></code></pre></div>
<p>type <code>srs</code> = <code>string list</code></p>
<h2 id='plugin-interface-plugin'>Interface: <code>Plugin</code></h2>
<p>Discover properties of this implementation. Every implementation must support the query interface or it will not be recognised as a storage plugin by xapi.</p>
<h2 id='plugin-method-query'>Method: <code>query</code></h2>
<p>Query this implementation and return its properties. This is  called by xapi to determine whether it is compatible with xapi  and to discover the supported features.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Plugin.query"</span><span class="p">,</span><span class="w"> </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">query_result</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">query</span> <span class="n">dbg</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Plugin</span><span class="p">.</span><span class="n">query</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"required_cluster_stack"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"required_cluster_stack_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"required_cluster_stack_2"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="nl">"features"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"features_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"features_2"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"required_api_version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"required_api_version"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"version"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"copyright"</span><span class="p">:</span><span class="w"> </span><span class="s2">"copyright"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"vendor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vendor"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"plugin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"plugin"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">query_result</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">query</span> <span class="n">dbg</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Plugin_myimplementation</span><span class="p">(</span><span class="n">Plugin_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">):</span>
        <span class="s">"""
        Query this implementation and return its properties. This is
        called by xapi to determine whether it is compatible with xapi
        and to discover the supported features.
        """</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"plugin"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"name"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"vendor"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"copyright"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"version"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"required_api_version"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"features"</span><span class="p">:</span> <span class="p">[</span><span class="s">"string"</span><span class="p">],</span> <span class="s">"configuration"</span><span class="p">:</span> <span class="p">{</span><span class="s">"string"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">},</span> <span class="s">"required_cluster_stack"</span><span class="p">:</span> <span class="p">[</span><span class="s">"string"</span><span class="p">]}</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>unnamed</td>
<td>out</td>
<td>query_result</td>
<td>Properties of this implementation.</td>
</tr>
</tbody></table>
<h2 id='plugin-method-ls'>Method: <code>ls</code></h2>
<p>[ls dbg]: returns a list of attached SRs</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Plugin.ls"</span><span class="p">,</span><span class="w"> </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">srs</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">ls</span> <span class="n">dbg</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Plugin</span><span class="p">.</span><span class="n">ls</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"srs_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"srs_2"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">srs</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">ls</span> <span class="n">dbg</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Plugin_myimplementation</span><span class="p">(</span><span class="n">Plugin_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">):</span>
        <span class="s">"""
        [ls dbg]: returns a list of attached SRs
        """</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">"string"</span><span class="p">]</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>srs</td>
<td>out</td>
<td>srs</td>
<td>The attached SRs</td>
</tr>
</tbody></table>
<h2 id='plugin-method-diagnostics'>Method: <code>diagnostics</code></h2>
<p>Returns a printable set of backend diagnostic information.  Implementations are encouraged to include any data which will  be useful to diagnose problems. Note this data should not  include personally-identifiable data as it is intended to be   automatically included in bug reports.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Plugin.diagnostics"</span><span class="p">,</span><span class="w"> </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">diagnostics</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">diagnostics</span> <span class="n">dbg</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Plugin</span><span class="p">.</span><span class="n">diagnostics</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="s2">"diagnostics"</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">diagnostics</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">diagnostics</span> <span class="n">dbg</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Plugin_myimplementation</span><span class="p">(</span><span class="n">Plugin_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">diagnostics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">):</span>
        <span class="s">"""
        Returns a printable set of backend diagnostic information.
        Implementations are encouraged to include any data which will
        be useful to diagnose problems. Note this data should not
        include personally-identifiable data as it is intended to be
        automatically included in bug reports.
        """</span>
        <span class="k">return</span> <span class="s">"string"</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>diagnostics</td>
<td>out</td>
<td>string</td>
<td>A string containing loggable human-readable diagnostics information</td>
</tr>
</tbody></table>
<h2 id='plugin-errors'>Errors</h2><h3 id='plugin-errors-exnt'>exnt</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"Unimplemented"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exnt"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>type <code>exnt</code> = <code>variant { ... }</code></p>
<h4 id='plugin-errors-exnt-constructors'>Constructors</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Unimplemented</td>
<td>string</td>
<td></td>
</tr>
</tbody></table>
<h1 id='datapath'>datapath</h1>
<p>The Datapath interfaces are provided to access the data stored
in the volumes. The <code>Datapath</code> interface is used to open and close the disks for read/write
operations from VMs and the <code>Data</code> interface is used for operations such as <code>copy</code> and <code>mirror</code></p>
<h2 id='datapath-type-definitions'>Type definitions</h2><h3 id='datapath-type-definitions-persistent'>persistent</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">true</span><span class="w">
</span><span class="kc">false</span><span class="w">
</span></code></pre></div>
<p>type <code>persistent</code> = <code>bool</code>
True means the disk data is persistent and should be preserved when the datapath is closed i.e. when a VM is shutdown or rebooted. False means the data should be thrown away when the VM is shutdown or rebooted.</p>
<h3 id='datapath-type-definitions-xendisk'>xendisk</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"backend_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"backend_type"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"extra"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"extra"</span><span class="p">:</span><span class="w"> </span><span class="s2">"extra"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="s2">"params"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>xendisk</code> = <code>struct { ... }</code></p>
<h4 id='datapath-type-definitions-xendisk-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>params</td>
<td>string</td>
<td>Put into the &quot;params&quot; key in xenstore</td>
</tr>
<tr>
<td>extra</td>
<td>(string * string) list</td>
<td>Key-value pairs to be put into the &quot;sm-data&quot; subdirectory underneath the xenstore backend</td>
</tr>
<tr>
<td>backend_type</td>
<td>string</td>
<td>The name of the xenstore directory corresponding to the backend. For example &quot;qdisk&quot;.</td>
</tr>
</tbody></table>
<h3 id='datapath-type-definitions-block_device'>block_device</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"path"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>block_device</code> = <code>struct { ... }</code></p>
<h4 id='datapath-type-definitions-block_device-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>path</td>
<td>string</td>
<td>Path to the system local block device. This is equivalent to the SMAPIv1 params.</td>
</tr>
</tbody></table>
<h3 id='datapath-type-definitions-file'>file</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"path"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>file</code> = <code>struct { ... }</code></p>
<h4 id='datapath-type-definitions-file-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>path</td>
<td>string</td>
<td>Path to the raw file</td>
</tr>
</tbody></table>
<h3 id='datapath-type-definitions-nbd'>nbd</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>nbd</code> = <code>struct { ... }</code></p>
<h4 id='datapath-type-definitions-nbd-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>uri</td>
<td>string</td>
<td>NBD URI of the form nbd:unix:&lt;domain-socket&gt;:exportname=&lt;NAME&gt; (this format is used by qemu-system: https://manpages.debian.org/stretch/qemu-system-x86/qemu-system-x86_64.1.en.html)</td>
</tr>
</tbody></table>
<h3 id='datapath-type-definitions-implementation'>implementation</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="s2">"XenDisk"</span><span class="p">,</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"backend_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"backend_type"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"extra"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"extra"</span><span class="p">:</span><span class="w"> </span><span class="s2">"extra"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="s2">"params"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"BlockDevice"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"path"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"File"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"path"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"Nbd"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>type <code>implementation</code> = <code>variant { ... }</code></p>
<h4 id='datapath-type-definitions-implementation-constructors'>Constructors</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>XenDisk</td>
<td>xendisk</td>
<td>This value can be used for ring connection.</td>
</tr>
<tr>
<td>BlockDevice</td>
<td>block_device</td>
<td>This value can be used for Domain0 block device access.</td>
</tr>
<tr>
<td>File</td>
<td>file</td>
<td></td>
</tr>
<tr>
<td>Nbd</td>
<td>nbd</td>
<td></td>
</tr>
</tbody></table>
<h3 id='datapath-type-definitions-backend'>backend</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"implementations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="s2">"XenDisk"</span><span class="p">,</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"backend_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"backend_type"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"extra"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"extra"</span><span class="p">:</span><span class="w"> </span><span class="s2">"extra"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="s2">"params"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>backend</code> = <code>struct { ... }</code>
A description of which Xen block backend to use. The toolstack needs this to setup the shared memory connection to blkfront in the VM.</p>
<h4 id='datapath-type-definitions-backend-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>implementations</td>
<td>implementation list</td>
<td>Choice of implementation technologies.</td>
</tr>
</tbody></table>
<h3 id='datapath-type-definitions-uri'>uri</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="s2">"uri"</span><span class="w">
</span></code></pre></div>
<p>type <code>uri</code> = <code>string</code>
A URI representing the means for accessing the volume data. The interpretation of the URI is specific to the implementation. Xapi will choose which implementation to use based on the URI scheme.</p>
<h3 id='datapath-type-definitions-domain'>domain</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="s2">"domain"</span><span class="w">
</span></code></pre></div>
<p>type <code>domain</code> = <code>string</code>
A string representing a Xen domain on the local host. The string is guaranteed to be unique per-domain but it is not guaranteed to take any particular form. It may (for example) be a Xen domain id, a Xen VM uuid or a Xenstore path or anything else chosen by the toolstack. Implementations should not assume the string has any meaning.</p>
<h3 id='datapath-type-definitions-blocklist'>blocklist</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"ranges"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nl">"blocksize"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>blocklist</code> = <code>struct { ... }</code>
List of blocks for copying.</p>
<h4 id='datapath-type-definitions-blocklist-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>blocksize</td>
<td>int</td>
<td>Size of the individual blocks.</td>
</tr>
<tr>
<td>ranges</td>
<td>int64 * int64 list</td>
<td>List of block ranges, where a range is a (start,length) pair, measured in units of [blocksize]</td>
</tr>
</tbody></table>
<h3 id='datapath-type-definitions-operation'>operation</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"Copy"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"operation"</span><span class="p">,</span><span class="w"> </span><span class="s2">"operation"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"Mirror"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"operation"</span><span class="p">,</span><span class="w"> </span><span class="s2">"operation"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>type <code>operation</code> = <code>variant { ... }</code>
The primary key for referring to a long-running operation.</p>
<h4 id='datapath-type-definitions-operation-constructors'>Constructors</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Copy</td>
<td>string * string</td>
<td>Copy (src,dst) represents an on-going copy operation from the [src] URI to the [dst] URI.</td>
</tr>
<tr>
<td>Mirror</td>
<td>string * string</td>
<td>Mirror (src,dst) represents an on-going mirror operation from the [src] URI to the [dst] URI.</td>
</tr>
</tbody></table>
<h3 id='datapath-type-definitions-status'>status</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"progress"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="nl">"failed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>status</code> = <code>struct { ... }</code>
Status information for on-going tasks.</p>
<h4 id='datapath-type-definitions-status-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>failed</td>
<td>bool</td>
<td>[failed] will be set to true if the operation has failed for some reason.</td>
</tr>
<tr>
<td>progress</td>
<td>float option</td>
<td>[progress] will be returned for a copy operation, and ranges between 0 and 1.</td>
</tr>
</tbody></table>
<h3 id='datapath-type-definitions-operations'>operations</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Copy"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"operations"</span><span class="p">,</span><span class="w"> </span><span class="s2">"operations"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[]</span><span class="w">
</span></code></pre></div>
<p>type <code>operations</code> = <code>operation list</code>
A list of operations.</p>
<h2 id='datapath-interface-datapath'>Interface: <code>Datapath</code></h2>
<p>Xapi will call the functions here on VM start / shutdown /
suspend / resume / migrate. Every function is idempotent. Every
function takes a domain parameter which allows the implementation
to track how many domains are currently using the volume.</p>

<p>Volumes must be attached via the following sequence of calls:</p>

<ol>
<li><p>[open url persistent] must be called first and is used to declare
that the writes to the disks must either be persisted or not.
[open] is not an exclusive operation - a disk may be opened on
more than once host at once. The call returns <code>unit</code> or an
error.</p></li>
<li><p>[attach url domain] is then called. The <code>domain</code> parameter is
advisory. Note that this call is currently only ever called once.
In the future the call may be made multiple times with different
[domain] parameters if the disk is attached to multiple domains.
The return value from this call is the information required to
attach the disk to a VM. This call is again, not exclusive. The
volume may be attached to more than one host concurrently.</p></li>
<li><p>[activate url domain] is called to activate the datapath. This
must be called before the volume is to be used by the VM, and
it is acceptible for this to be an exclusive operation, such that
it is an error for a volume to be activated on more than one host
simultaneously.</p></li>
</ol>
<h2 id='datapath-method-open'>Method: <code>open</code></h2>
<p>[open uri persistent] is called before a disk is attached to a VM. If persistent is true then care should be taken to persist all writes to the disk. If persistent is false then the implementation should configure a temporary location for writes so they can be thrown away on [close].</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Datapath.open"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"persistent"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">31</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">open</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">persistent</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Datapath</span><span class="p">.</span><span class="nb">open</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">persistent</span><span class="p">:</span> <span class="bp">True</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">open</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">persistent</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Datapath_myimplementation</span><span class="p">(</span><span class="n">Datapath_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">persistent</span><span class="p">):</span>
        <span class="s">"""
        [open uri persistent] is called before a disk is attached to a VM.
        If persistent is true then care should be taken to persist all writes
        to the disk. If persistent is false then the implementation should
        configure a temporary location for writes so they can be thrown away
        on [close].
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>uri</td>
<td>in</td>
<td>uri</td>
<td>A URI which represents how to access the volume disk data.</td>
</tr>
<tr>
<td>persistent</td>
<td>in</td>
<td>persistent</td>
<td>True means the disk data is persistent and should be preserved when the datapath is closed i.e. when a VM is shutdown or rebooted. False means the data should be thrown away when the VM is shutdown or rebooted.</td>
</tr>
</tbody></table>
<h2 id='datapath-method-attach'>Method: <code>attach</code></h2>
<p>[attach uri domain] prepares a connection between the storage named by [uri] and the Xen domain with id [domain]. The return value is the information needed by the Xen toolstack to setup the shared-memory blkfront protocol. Note that the same volume may be simultaneously attached to multiple hosts for example over a migrate. If an implementation needs to perform an explicit handover, then it should implement [activate] and [deactivate]. This function is idempotent.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Datapath.attach"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"domain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domain"</span><span class="p">,</span><span class="w"> </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">32</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">backend</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">attach</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">domain</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Datapath</span><span class="p">.</span><span class="n">attach</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"implementations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="s2">"XenDisk"</span><span class="p">,</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"backend_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"backend_type"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"extra"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="s2">"params"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="s2">"XenDisk"</span><span class="p">,</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"backend_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"backend_type"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"extra"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
        </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="s2">"params"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">backend</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">attach</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">domain</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Datapath_myimplementation</span><span class="p">(</span><span class="n">Datapath_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">attach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="s">"""
        [attach uri domain] prepares a connection between the storage named by
        [uri] and the Xen domain with id [domain]. The return value is the
        information needed by the Xen toolstack to setup the shared-memory
        blkfront protocol. Note that the same volume may be simultaneously
        attached to multiple hosts for example over a migrate. If an
        implementation needs to perform an explicit handover, then it should
        implement [activate] and [deactivate]. This function is idempotent.
        """</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"implementations"</span><span class="p">:</span> <span class="p">[</span><span class="bp">None</span><span class="p">]}</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>uri</td>
<td>in</td>
<td>uri</td>
<td>A URI which represents how to access the volume disk data.</td>
</tr>
<tr>
<td>domain</td>
<td>in</td>
<td>domain</td>
<td>An opaque string which represents the Xen domain.</td>
</tr>
<tr>
<td>backend</td>
<td>out</td>
<td>backend</td>
<td>A description of which Xen block backend to use. The toolstack needs this to setup the shared memory connection to blkfront in the VM.</td>
</tr>
</tbody></table>
<h2 id='datapath-method-activate'>Method: <code>activate</code></h2>
<p>[activate uri domain] is called just before a VM needs to read or write its disk. This is an opportunity for an implementation which needs to perform an explicit volume handover to do it. This function is called in the migration downtime window so delays here will be noticeable to users and should be minimised. This function is idempotent.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Datapath.activate"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"domain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domain"</span><span class="p">,</span><span class="w"> </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">33</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">activate</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">domain</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Datapath</span><span class="p">.</span><span class="n">activate</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">activate</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">domain</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Datapath_myimplementation</span><span class="p">(</span><span class="n">Datapath_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="s">"""
        [activate uri domain] is called just before a VM needs to read or write
        its disk. This is an opportunity for an implementation which needs to
        perform an explicit volume handover to do it. This function is called
        in the migration downtime window so delays here will be noticeable to
        users and should be minimised. This function is idempotent.
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>uri</td>
<td>in</td>
<td>uri</td>
<td>A URI which represents how to access the volume disk data.</td>
</tr>
<tr>
<td>domain</td>
<td>in</td>
<td>domain</td>
<td>An opaque string which represents the Xen domain.</td>
</tr>
</tbody></table>
<h2 id='datapath-method-activate_readonly'>Method: <code>activate_readonly</code></h2>
<p>[activate_readonly uri domain] is called just before a VM, or the  control domain, needs to read a volume. A single volume may be  activated readonly multiple times, including on multiple independent  hosts. It is not permitted for a volume to be activated both readonly  and read-write concurrently. Implementations shall declare the  VDI_ACTIVATE_READONLY feature for this method to be supported. Once a  volume is activated readonly it is required that all readonly  activations are deactivated before any read-write activation is  attempted. This function is idempotent and in all other respects  is interchangeable with activate.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Datapath.activate_readonly"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"domain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domain"</span><span class="p">,</span><span class="w"> </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">34</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">activate_readonly</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">domain</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Datapath</span><span class="p">.</span><span class="n">activate_readonly</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">activate_readonly</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">domain</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Datapath_myimplementation</span><span class="p">(</span><span class="n">Datapath_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">activate_readonly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="s">"""
        [activate_readonly uri domain] is called just before a VM, or the
        control domain, needs to read a volume. A single volume may be
        activated readonly multiple times, including on multiple independent
        hosts. It is not permitted for a volume to be activated both readonly
        and read-write concurrently. Implementations shall declare the
        VDI_ACTIVATE_READONLY feature for this method to be supported. Once a
        volume is activated readonly it is required that all readonly
        activations are deactivated before any read-write activation is
        attempted. This function is idempotent and in all other respects
        is interchangeable with activate.
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>uri</td>
<td>in</td>
<td>uri</td>
<td>A URI which represents how to access the volume disk data.</td>
</tr>
<tr>
<td>domain</td>
<td>in</td>
<td>domain</td>
<td>An opaque string which represents the Xen domain.</td>
</tr>
</tbody></table>
<h2 id='datapath-method-deactivate'>Method: <code>deactivate</code></h2>
<p>[deactivate uri domain] is called as soon as a VM has finished reading or writing its disk. This is an opportunity for an implementation which needs to perform an explicit volume handover to do it. This function is called in the migration downtime window so delays here will be noticeable to users and should be minimised. This function is idempotent.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Datapath.deactivate"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"domain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domain"</span><span class="p">,</span><span class="w"> </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">deactivate</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">domain</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Datapath</span><span class="p">.</span><span class="n">deactivate</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">deactivate</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">domain</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Datapath_myimplementation</span><span class="p">(</span><span class="n">Datapath_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="s">"""
        [deactivate uri domain] is called as soon as a VM has finished reading
        or writing its disk. This is an opportunity for an implementation which
        needs to perform an explicit volume handover to do it. This function is
        called in the migration downtime window so delays here will be
        noticeable to users and should be minimised. This function is idempotent.
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>uri</td>
<td>in</td>
<td>uri</td>
<td>A URI which represents how to access the volume disk data.</td>
</tr>
<tr>
<td>domain</td>
<td>in</td>
<td>domain</td>
<td>An opaque string which represents the Xen domain.</td>
</tr>
</tbody></table>
<h2 id='datapath-method-detach'>Method: <code>detach</code></h2>
<p>[detach uri domain] is called sometime after a VM has finished reading or writing its disk. This is an opportunity to clean up any resources associated with the disk. This function is called outside the migration downtime window so can be slow without affecting users. This function is idempotent. This function should never fail. If an implementation is unable to perform some cleanup right away then it should queue the action internally. Any error result represents a bug in the implementation.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Datapath.detach"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"domain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domain"</span><span class="p">,</span><span class="w"> </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">36</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">detach</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">domain</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Datapath</span><span class="p">.</span><span class="n">detach</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">detach</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">domain</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Datapath_myimplementation</span><span class="p">(</span><span class="n">Datapath_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="s">"""
        [detach uri domain] is called sometime after a VM has finished reading
        or writing its disk. This is an opportunity to clean up any resources
        associated with the disk. This function is called outside the migration
        downtime window so can be slow without affecting users. This function is
        idempotent. This function should never fail. If an implementation is
        unable to perform some cleanup right away then it should queue the
        action internally. Any error result represents a bug in the
        implementation.
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>uri</td>
<td>in</td>
<td>uri</td>
<td>A URI which represents how to access the volume disk data.</td>
</tr>
<tr>
<td>domain</td>
<td>in</td>
<td>domain</td>
<td>An opaque string which represents the Xen domain.</td>
</tr>
</tbody></table>
<h2 id='datapath-method-close'>Method: <code>close</code></h2>
<p>[close uri] is called after a disk is detached and a VM shutdown. This is an opportunity to throw away writes if the disk is not persistent.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Datapath.close"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">37</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">close</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Datapath</span><span class="p">.</span><span class="n">close</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">close</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Datapath_myimplementation</span><span class="p">(</span><span class="n">Datapath_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">uri</span><span class="p">):</span>
        <span class="s">"""
        [close uri] is called after a disk is detached and a VM shutdown. This
        is an opportunity to throw away writes if the disk is not persistent.
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>uri</td>
<td>in</td>
<td>uri</td>
<td>A URI which represents how to access the volume disk data.</td>
</tr>
</tbody></table>
<h2 id='datapath-interface-data'>Interface: <code>Data</code></h2>
<p>This interface is used for long-running data operations such as
copying the contents of volumes or mirroring volumes to remote
destinations.</p>

<p>These operations are asynchronous and rely on the Tasks API to
report results and errors.</p>

<p>To mirror a VDI a sequence of these API calls is required:</p>

<ol>
<li><p>Create a destination VDI using the Volume API on the destination
SR. This must be the same size as the source. To minimize copying
the destination VDI may be cloned from one that has been previously
copied, as long as a disk from which the copy was made is still
present on the source (even as a metadata-only disk)</p></li>
<li><p>Arrange for the destination disk to be accessible on the source
host by suitable URL. This may be <code>nbd</code>, <code>iscsi</code>, <code>nfs</code> or
other URL.</p></li>
<li><p>Start mirroring all new writes to the destination disk via the
<code>Data.mirror</code> API call.</p></li>
<li><p>Find the list of blocks to copy via the CBT API call. Note that if
the destination volume has not been &#39;prezeroed&#39; then all of the
blocks must be copied to the destination.</p></li>
<li><p>Start the background copy of the disk via a call to <code>DATA.copy</code>,
passing in the list of blocks to copy. The plugin must ensure that
the copy does not conflict with the mirror operation - ie., all
writes from the mirror operation must not be overwritten by writes
of old data from the copy operation.</p></li>
<li><p>The progress of the copy operation may be queried via the <code>Data.stat</code>
call.</p></li>
<li><p>Once the copy operation has succesfully completed the destination
disk will be a perfect mirror of the source.</p></li>
</ol>
<h2 id='datapath-method-copy'>Method: <code>copy</code></h2>
<p>[copy uri domain remotes blocks] copies [blocks] from the local disk  to a remote URI. This may be called as part of a Volume Mirroring  operation, and hence may need to cooperate with whatever process is  currently mirroring writes to ensure data integrity is maintained. The [remote] parameter is a remotely accessible URI, for example, <code>nbd://root:pass@foo.com/path/to/disk</code> that must contain all necessary authentication tokens</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Data.copy"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"blocklist"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"ranges"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nl">"blocksize"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="nl">"remote"</span><span class="p">:</span><span class="w"> </span><span class="s2">"remote"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"domain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domain"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">38</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">operation</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">copy</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">domain</span> <span class="n">remote</span> <span class="n">blocklist</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">copy</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">remote</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">blocklist</span><span class="p">:</span> <span class="p">{</span><span class="s">"blocksize"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"ranges"</span><span class="p">:</span> <span class="p">[[]]}</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"Copy"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Copy_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Copy_2"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">operation</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">copy</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">domain</span> <span class="n">remote</span> <span class="n">blocklist</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Data_myimplementation</span><span class="p">(</span><span class="n">Data_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">remote</span><span class="p">,</span> <span class="n">blocklist</span><span class="p">):</span>
        <span class="s">"""
        [copy uri domain remotes blocks] copies [blocks] from the local disk
        to a remote URI. This may be called as part of a Volume Mirroring
        operation, and hence may need to cooperate with whatever process is
        currently mirroring writes to ensure data integrity is maintained.
        The [remote] parameter is a remotely accessible URI, for example,
        `nbd://root:pass@foo.com/path/to/disk` that must contain all necessary
        authentication tokens
        """</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>uri</td>
<td>in</td>
<td>uri</td>
<td>A URI which represents how to access the volume disk data.</td>
</tr>
<tr>
<td>domain</td>
<td>in</td>
<td>domain</td>
<td>An opaque string which represents the Xen domain.</td>
</tr>
<tr>
<td>remote</td>
<td>in</td>
<td>uri</td>
<td>A URI which represents how to access a remote volume disk data.</td>
</tr>
<tr>
<td>blocklist</td>
<td>in</td>
<td>blocklist</td>
<td>List of blocks for copying.</td>
</tr>
<tr>
<td>operation</td>
<td>out</td>
<td>operation</td>
<td>The primary key for referring to a long-running operation.</td>
</tr>
</tbody></table>
<h2 id='datapath-method-mirror'>Method: <code>mirror</code></h2>
<p>[mirror uri domain remote] starts mirroring new writes to the volume  to a remote URI (usually NBD). This is called as part of a volume  mirroring process</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Data.mirror"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"remote"</span><span class="p">:</span><span class="w"> </span><span class="s2">"remote"</span><span class="p">,</span><span class="w"> </span><span class="nl">"domain"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domain"</span><span class="p">,</span><span class="w"> </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uri"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">39</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">operation</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">mirror</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">domain</span> <span class="n">remote</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">mirror</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">uri</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">remote</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"Copy"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Copy_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Copy_2"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">operation</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">mirror</span> <span class="n">dbg</span> <span class="n">uri</span> <span class="n">domain</span> <span class="n">remote</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Data_myimplementation</span><span class="p">(</span><span class="n">Data_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">mirror</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">remote</span><span class="p">):</span>
        <span class="s">"""
        [mirror uri domain remote] starts mirroring new writes to the volume
        to a remote URI (usually NBD). This is called as part of a volume
        mirroring process
        """</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>uri</td>
<td>in</td>
<td>uri</td>
<td>A URI which represents how to access the volume disk data.</td>
</tr>
<tr>
<td>domain</td>
<td>in</td>
<td>domain</td>
<td>An opaque string which represents the Xen domain.</td>
</tr>
<tr>
<td>remote</td>
<td>in</td>
<td>uri</td>
<td>A URI which represents how to access a remote volume disk data.</td>
</tr>
<tr>
<td>operation</td>
<td>out</td>
<td>operation</td>
<td>The primary key for referring to a long-running operation.</td>
</tr>
</tbody></table>
<h2 id='datapath-method-stat'>Method: <code>stat</code></h2>
<p>[stat operation] returns the current status of [operation]. For a  copy operation, this will contain progress information.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Data.stat"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"operation"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Copy"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Copy_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Copy_2"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">status</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">stat</span> <span class="n">dbg</span> <span class="n">operation</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">stat</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">operation</span><span class="p">:</span> <span class="bp">None</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"progress"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="nl">"failed"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">status</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">stat</span> <span class="n">dbg</span> <span class="n">operation</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Data_myimplementation</span><span class="p">(</span><span class="n">Data_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">operation</span><span class="p">):</span>
        <span class="s">"""
        [stat operation] returns the current status of [operation]. For a
        copy operation, this will contain progress information.
        """</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"failed"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"progress"</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>operation</td>
<td>in</td>
<td>operation</td>
<td>The primary key for referring to a long-running operation.</td>
</tr>
<tr>
<td>unnamed</td>
<td>out</td>
<td>status</td>
<td>Status information for on-going tasks.</td>
</tr>
</tbody></table>
<h2 id='datapath-method-cancel'>Method: <code>cancel</code></h2>
<p>[cancel operation] cancels a long-running operation. Note that the  call may return before the operation has finished.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Data.cancel"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"operation"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Copy"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Copy_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Copy_2"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">41</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">cancel</span> <span class="n">dbg</span> <span class="n">operation</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">cancel</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">operation</span><span class="p">:</span> <span class="bp">None</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">cancel</span> <span class="n">dbg</span> <span class="n">operation</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Data_myimplementation</span><span class="p">(</span><span class="n">Data_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">operation</span><span class="p">):</span>
        <span class="s">"""
        [cancel operation] cancels a long-running operation. Note that the
        call may return before the operation has finished.
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>operation</td>
<td>in</td>
<td>operation</td>
<td>The primary key for referring to a long-running operation.</td>
</tr>
</tbody></table>
<h2 id='datapath-method-destroy'>Method: <code>destroy</code></h2>
<p>[destroy operation] destroys the information about a long-running  operation. This should fail when run against an operation that is  still in progress.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Data.destroy"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"operation"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Copy"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Copy_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Copy_2"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">destroy</span> <span class="n">dbg</span> <span class="n">operation</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">destroy</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">operation</span><span class="p">:</span> <span class="bp">None</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">destroy</span> <span class="n">dbg</span> <span class="n">operation</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Data_myimplementation</span><span class="p">(</span><span class="n">Data_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">operation</span><span class="p">):</span>
        <span class="s">"""
        [destroy operation] destroys the information about a long-running
        operation. This should fail when run against an operation that is
        still in progress.
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>operation</td>
<td>in</td>
<td>operation</td>
<td>The primary key for referring to a long-running operation.</td>
</tr>
</tbody></table>
<h2 id='datapath-method-ls'>Method: <code>ls</code></h2>
<p>[ls] returns a list of all current operations</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Data.ls"</span><span class="p">,</span><span class="w"> </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">43</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">operations</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">ls</span> <span class="n">dbg</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">ls</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Copy"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Copy_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Copy_2"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Copy"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Copy_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Copy_2"</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">operations</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">ls</span> <span class="n">dbg</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Data_myimplementation</span><span class="p">(</span><span class="n">Data_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">):</span>
        <span class="s">"""
        [ls] returns a list of all current operations
        """</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>unnamed</td>
<td>out</td>
<td>operations</td>
<td>A list of operations.</td>
</tr>
</tbody></table>
<h2 id='datapath-errors'>Errors</h2><h3 id='datapath-errors-exnt'>exnt</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"Unimplemented"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exnt"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>type <code>exnt</code> = <code>variant { ... }</code></p>
<h4 id='datapath-errors-exnt-constructors'>Constructors</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Unimplemented</td>
<td>string</td>
<td></td>
</tr>
</tbody></table>
<h3 id='datapath-errors-exnt'>exnt</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"Unimplemented"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exnt"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>type <code>exnt</code> = <code>variant { ... }</code></p>
<h4 id='datapath-errors-exnt-constructors'>Constructors</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Unimplemented</td>
<td>string</td>
<td></td>
</tr>
</tbody></table>
<h1 id='volume'>volume</h1>
<p>The xapi toolstack delegates all storage control-plane functions to  &quot;Volume plugins&quot;.These plugins allow the toolstack to  create/destroy/snapshot/clone volumes which are organised into groups  called Storage Repositories (SR). Volumes have a set of URIs which  can be used by the &quot;Datapath plugins&quot; to connect the disk data to  VMs.</p>
<h2 id='volume-type-definitions'>Type definitions</h2><h3 id='volume-type-definitions-configuration'>configuration</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="s2">"configuration"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>configuration</code> = <code>(string * string) list</code>
Plugin-specific configuration which describes where and how to locate the storage repository. This may include the physical block device name, a remote NFS server and path or an RBD storage pool.</p>
<h3 id='volume-type-definitions-health'>health</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"Healthy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"health"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"Recovering"</span><span class="p">,</span><span class="w"> </span><span class="s2">"health"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>type <code>health</code> = <code>variant { ... }</code></p>
<h4 id='volume-type-definitions-health-constructors'>Constructors</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Healthy</td>
<td>string</td>
<td>Storage is fully available</td>
</tr>
<tr>
<td>Recovering</td>
<td>string</td>
<td>Storage is busy recovering, e.g. rebuilding mirrors</td>
</tr>
</tbody></table>
<h3 id='volume-type-definitions-sr_stat'>sr_stat</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"health"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Healthy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"health"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"clustered"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"datasources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"datasources"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"total_space"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"free_space"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uuid"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>sr_stat</code> = <code>struct { ... }</code></p>
<h4 id='volume-type-definitions-sr_stat-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>sr</td>
<td>string</td>
<td>The URI identifying this volume. A typical value would be a file:// URI pointing to a directory or block device</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Short, human-readable label for the SR.</td>
</tr>
<tr>
<td>uuid</td>
<td>string option</td>
<td>Uuid that uniquely identifies this SR, if one is available. For SRs that are created by SR.create, this should be the value passed into that call, if it is possible to persist it.</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Longer, human-readable description of the SR. Descriptions are generally only displayed by clients when the user is examining SRs in detail.</td>
</tr>
<tr>
<td>free_space</td>
<td>int64</td>
<td>Number of bytes free on the backing storage (in bytes)</td>
</tr>
<tr>
<td>total_space</td>
<td>int64</td>
<td>Total physical size of the backing storage (in bytes)</td>
</tr>
<tr>
<td>datasources</td>
<td>string list</td>
<td>URIs naming datasources: time-varying quantities representing anything from disk access latency to free space. The entities named by these URIs are self-describing.</td>
</tr>
<tr>
<td>clustered</td>
<td>bool</td>
<td>Indicates whether the SR uses clustered local storage.</td>
</tr>
<tr>
<td>health</td>
<td>health</td>
<td>The health status of the SR.</td>
</tr>
</tbody></table>
<h3 id='volume-type-definitions-probe_result'>probe_result</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"extra_info"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"extra_info"</span><span class="p">:</span><span class="w"> </span><span class="s2">"extra_info"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"health"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Healthy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"health"</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nl">"clustered"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"datasources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"datasources"</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nl">"total_space"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"free_space"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uuid"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"complete"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="s2">"configuration"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>probe_result</code> = <code>struct { ... }</code></p>
<h4 id='volume-type-definitions-probe_result-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>configuration</td>
<td>(string * string) list</td>
<td>Plugin-specific configuration which describes where and how to locate the storage repository. This may include the physical block device name, a remote NFS server and path or an RBD storage pool.</td>
</tr>
<tr>
<td>complete</td>
<td>bool</td>
<td>True if this configuration is complete and can be used to call SR.create or SR.attach. False if it requires further iterative calls to SR.probe, to potentially narrow down on a configuration that can be used.</td>
</tr>
<tr>
<td>sr</td>
<td>sr_stat option</td>
<td>Existing SR found for this configuration</td>
</tr>
<tr>
<td>extra_info</td>
<td>(string * string) list</td>
<td>Additional plugin-specific information about this configuration, that might be of use for an API user. This can for example include the LUN or the WWPN.</td>
</tr>
</tbody></table>
<h3 id='volume-type-definitions-probe_results'>probe_results</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"extra_info"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"extra_info"</span><span class="p">:</span><span class="w"> </span><span class="s2">"extra_info"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"health"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Healthy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"health"</span><span class="w"> </span><span class="p">],</span><span class="w">
      </span><span class="nl">"clustered"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"datasources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"datasources"</span><span class="w"> </span><span class="p">],</span><span class="w">
      </span><span class="nl">"total_space"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nl">"free_space"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uuid"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"complete"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="s2">"configuration"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span><span class="p">[]</span><span class="w">
</span></code></pre></div>
<p>type <code>probe_results</code> = <code>probe_result list</code></p>
<h3 id='volume-type-definitions-volume'>volume</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"keys"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"uri"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"physical_utilisation"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"virtual_size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sharable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"read_write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uuid"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>volume</code> = <code>struct { ... }</code></p>
<h4 id='volume-type-definitions-volume-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>key</td>
<td>string</td>
<td>A primary key for this volume. The key must be unique within the enclosing Storage Repository (SR). A typical value would be a filename or an LVM volume name.</td>
</tr>
<tr>
<td>uuid</td>
<td>string option</td>
<td>A uuid (or guid) for the volume, if one is available. If a storage system has a built-in notion of a guid, then it will be returned here.</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Short, human-readable label for the volume. Names are commonly used by when displaying short lists of volumes.</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Longer, human-readable description of the volume. Descriptions are generally only displayed by clients when the user is examining volumes individually.</td>
</tr>
<tr>
<td>read_write</td>
<td>bool</td>
<td>True means the VDI may be written to, false means the volume is read-only. Some storage media is read-only so all volumes are read-only; for example .iso disk images on an NFS share. Some volume are created read-only; for example because they are snapshots of some other VDI.</td>
</tr>
<tr>
<td>sharable</td>
<td>bool</td>
<td>Indicates whether the VDI can be attached by multiple hosts at once. This is used for example by the HA statefile and XAPI redo log.</td>
</tr>
<tr>
<td>virtual_size</td>
<td>int64</td>
<td>Size of the volume from the perspective of a VM (in bytes)</td>
</tr>
<tr>
<td>physical_utilisation</td>
<td>int64</td>
<td>Amount of space currently used on the backing storage (in bytes)</td>
</tr>
<tr>
<td>uri</td>
<td>string list</td>
<td>A list of URIs which can be opened and by a datapath plugin for I/O. A URI could reference a local block device, a remote NFS share, iSCSI LUN or RBD volume. In cases where the data may be accessed over several protocols, the list should be sorted into descending order of desirability. Xapi will open the most desirable URI for which it has an available datapath plugin.</td>
</tr>
<tr>
<td>keys</td>
<td>(string * string) list</td>
<td>A list of key=value pairs which have been stored in the Volume metadata. These should not be interpreted by the Volume plugin.</td>
</tr>
</tbody></table>
<h3 id='volume-type-definitions-volumes'>volumes</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"keys"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"uri"</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nl">"physical_utilisation"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"virtual_size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sharable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"read_write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uuid"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span><span class="p">[]</span><span class="w">
</span></code></pre></div>
<p>type <code>volumes</code> = <code>volume list</code>
A list of volumes</p>
<h3 id='volume-type-definitions-key'>key</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="s2">"key"</span><span class="w">
</span></code></pre></div>
<p>type <code>key</code> = <code>string</code>
Primary key for a volume. This can be any string which is meaningful to the implementation. For example this could be an NFS filename, an LVM LV name or even a URI. This string is abstract.</p>
<h3 id='volume-type-definitions-blocklist'>blocklist</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"ranges"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nl">"blocksize"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>blocklist</code> = <code>struct { ... }</code>
List of blocks for copying.</p>
<h4 id='volume-type-definitions-blocklist-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>blocksize</td>
<td>int</td>
<td>Size of the individual blocks.</td>
</tr>
<tr>
<td>ranges</td>
<td>int64 * int64 list</td>
<td>List of block ranges, where a range is a (start,length) pair, measured in units of [blocksize]</td>
</tr>
</tbody></table>
<h3 id='volume-type-definitions-key_list'>key_list</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"key_list"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[]</span><span class="w">
</span></code></pre></div>
<p>type <code>key_list</code> = <code>string list</code></p>
<h3 id='volume-type-definitions-changed_blocks'>changed_blocks</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"bitmap"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bitmap"</span><span class="p">,</span><span class="w"> </span><span class="nl">"granularity"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>changed_blocks</code> = <code>struct { ... }</code></p>
<h4 id='volume-type-definitions-changed_blocks-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>granularity</td>
<td>int</td>
<td>One bit in the changed block bitmap indicates the status of an area of this size, in bytes.</td>
</tr>
<tr>
<td>bitmap</td>
<td>string</td>
<td>The changed blocks between two volumes as a base64-encoded string. The bits in the bitmap indicate the status of consecutive blocks of size [granularity] bytes. Each bit is set if the corresponding area has changed.</td>
</tr>
</tbody></table>
<h2 id='volume-interface-sr'>Interface: <code>SR</code></h2>
<p>Operations which act on Storage Repositories</p>
<h2 id='volume-method-probe'>Method: <code>probe</code></h2>
<p>[probe configuration]: can be used iteratively to narrow down configurations to use with SR.create, or to find existing SRs on the backing storage</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SR.probe"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">probe_result</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">probe</span> <span class="n">dbg</span> <span class="n">configuration</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">SR</span><span class="p">.</span><span class="n">probe</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="p">{</span><span class="s">"string"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">}</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"extra_info"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"health"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Healthy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Healthy"</span><span class="w"> </span><span class="p">],</span><span class="w">
      </span><span class="nl">"clustered"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"datasources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"datasources_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"datasources_2"</span><span class="w"> </span><span class="p">],</span><span class="w">
      </span><span class="nl">"total_space"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nl">"free_space"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional_uuid"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"complete"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"extra_info"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"health"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Healthy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Healthy"</span><span class="w"> </span><span class="p">],</span><span class="w">
      </span><span class="nl">"clustered"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"datasources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"datasources_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"datasources_2"</span><span class="w"> </span><span class="p">],</span><span class="w">
      </span><span class="nl">"total_space"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nl">"free_space"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional_uuid"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"complete"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">probe_result</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">probe</span> <span class="n">dbg</span> <span class="n">configuration</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">SR_myimplementation</span><span class="p">(</span><span class="n">SR_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">probe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="s">"""
        [probe configuration]: can be used iteratively to narrow down configurations
        to use with SR.create, or to find existing SRs on the backing storage
        """</span>
        <span class="k">return</span> <span class="p">[{</span><span class="s">"configuration"</span><span class="p">:</span> <span class="p">{</span><span class="s">"string"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">},</span> <span class="s">"complete"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"sr"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"extra_info"</span><span class="p">:</span> <span class="p">{</span><span class="s">"string"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">}}]</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>configuration</td>
<td>in</td>
<td>configuration</td>
<td>Plugin-specific configuration which describes where and how to locate the storage repository. This may include the physical block device name, a remote NFS server and path or an RBD storage pool.</td>
</tr>
<tr>
<td>probe_result</td>
<td>out</td>
<td>probe_results</td>
<td>Contents of the storage device</td>
</tr>
</tbody></table>
<h2 id='volume-method-create'>Method: <code>create</code></h2>
<p>[create uuid configuration name description]: creates a fresh SR</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SR.create"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uuid"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">configuration</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">create</span> <span class="n">dbg</span> <span class="n">uuid</span> <span class="n">configuration</span> <span class="n">name</span> <span class="n">description</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">SR</span><span class="p">.</span><span class="n">create</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">uuid</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="p">{</span><span class="s">"string"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">},</span> <span class="n">name</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">configuration</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">create</span> <span class="n">dbg</span> <span class="n">uuid</span> <span class="n">configuration</span> <span class="n">name</span> <span class="n">description</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">SR_myimplementation</span><span class="p">(</span><span class="n">SR_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">uuid</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="s">"""
        [create uuid configuration name description]: creates a fresh SR
        """</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"string"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">}</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>uuid</td>
<td>in</td>
<td>string</td>
<td>A uuid to associate with the SR.</td>
</tr>
<tr>
<td>configuration</td>
<td>in</td>
<td>configuration</td>
<td>Plugin-specific configuration which describes where and how to locate the storage repository. This may include the physical block device name, a remote NFS server and path or an RBD storage pool.</td>
</tr>
<tr>
<td>name</td>
<td>in</td>
<td>string</td>
<td>Human-readable name for the SR</td>
</tr>
<tr>
<td>description</td>
<td>in</td>
<td>string</td>
<td>Human-readable description for the SR</td>
</tr>
<tr>
<td>configuration</td>
<td>out</td>
<td>configuration</td>
<td>Plugin-specific configuration which describes where and how to locate the storage repository. This may include the physical block device name, a remote NFS server and path or an RBD storage pool.</td>
</tr>
</tbody></table>
<h2 id='volume-method-attach'>Method: <code>attach</code></h2>
<p>[attach configuration]: attaches the SR to the local host. Once an SR is  attached then volumes may be manipulated.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SR.attach"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"configuration"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
      </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">sr</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">attach</span> <span class="n">dbg</span> <span class="n">configuration</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">SR</span><span class="p">.</span><span class="n">attach</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="p">{</span><span class="s">"string"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">}</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="s2">"sr"</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">sr</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">attach</span> <span class="n">dbg</span> <span class="n">configuration</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">SR_myimplementation</span><span class="p">(</span><span class="n">SR_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">attach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">configuration</span><span class="p">):</span>
        <span class="s">"""
        [attach configuration]: attaches the SR to the local host. Once an SR is
        attached then volumes may be manipulated.
        """</span>
        <span class="k">return</span> <span class="s">"string"</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>configuration</td>
<td>in</td>
<td>configuration</td>
<td>Plugin-specific configuration which describes where and how to locate the storage repository. This may include the physical block device name, a remote NFS server and path or an RBD storage pool.</td>
</tr>
<tr>
<td>sr</td>
<td>out</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
</tbody></table>
<h2 id='volume-method-detach'>Method: <code>detach</code></h2>
<p>[detach sr]: detaches the SR, clearing up any associated resources.  Once the SR is detached then volumes may not be manipulated.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SR.detach"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">detach</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">SR</span><span class="p">.</span><span class="n">detach</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">detach</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">SR_myimplementation</span><span class="p">(</span><span class="n">SR_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">detach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">):</span>
        <span class="s">"""
        [detach sr]: detaches the SR, clearing up any associated resources.
        Once the SR is detached then volumes may not be manipulated.
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
</tbody></table>
<h2 id='volume-method-destroy'>Method: <code>destroy</code></h2>
<p>[destroy sr]: destroys the [sr] and deletes any volumes associated  with it. Note that an SR must be attached to be destroyed; otherwise  Sr_not_attached is thrown.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SR.destroy"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">8</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">destroy</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">SR</span><span class="p">.</span><span class="n">destroy</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">destroy</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">SR_myimplementation</span><span class="p">(</span><span class="n">SR_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">):</span>
        <span class="s">"""
        [destroy sr]: destroys the [sr] and deletes any volumes associated
        with it. Note that an SR must be attached to be destroyed; otherwise
        Sr_not_attached is thrown.
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
</tbody></table>
<h2 id='volume-method-stat'>Method: <code>stat</code></h2>
<p>[stat sr] returns summary metadata associated with [sr]. Note this  call does not return details of sub-volumes, see SR.ls.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SR.stat"</span><span class="p">,</span><span class="w"> </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">sr</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">stat</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">SR</span><span class="p">.</span><span class="n">stat</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"health"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Healthy"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Healthy"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"clustered"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"datasources"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"datasources_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"datasources_2"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"total_space"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"free_space"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional_uuid"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">sr</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">stat</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">SR_myimplementation</span><span class="p">(</span><span class="n">SR_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">):</span>
        <span class="s">"""
        [stat sr] returns summary metadata associated with [sr]. Note this
        call does not return details of sub-volumes, see SR.ls.
        """</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"sr"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"name"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"uuid"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"free_space"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"total_space"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"datasources"</span><span class="p">:</span> <span class="p">[</span><span class="s">"string"</span><span class="p">],</span> <span class="s">"clustered"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"health"</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>sr</td>
<td>out</td>
<td>sr_stat</td>
<td>SR metadata</td>
</tr>
</tbody></table>
<h2 id='volume-method-set_name'>Method: <code>set_name</code></h2>
<p>[set_name sr new_name] changes the name of [sr]</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SR.set_name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"new_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"new_name"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">set_name</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">new_name</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">SR</span><span class="p">.</span><span class="n">set_name</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">new_name</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">set_name</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">new_name</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">SR_myimplementation</span><span class="p">(</span><span class="n">SR_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
        <span class="s">"""
        [set_name sr new_name] changes the name of [sr]
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>new_name</td>
<td>in</td>
<td>string</td>
<td>The new name of the SR</td>
</tr>
</tbody></table>
<h2 id='volume-method-set_description'>Method: <code>set_description</code></h2>
<p>[set_description sr new_description] changes the description of [sr]</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SR.set_description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"new_description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"new_description"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">set_description</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">new_description</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">SR</span><span class="p">.</span><span class="n">set_description</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">new_description</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">set_description</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">new_description</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">SR_myimplementation</span><span class="p">(</span><span class="n">SR_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">set_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">new_description</span><span class="p">):</span>
        <span class="s">"""
        [set_description sr new_description] changes the description of [sr]
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>new_description</td>
<td>in</td>
<td>string</td>
<td>The new description for the SR</td>
</tr>
</tbody></table>
<h2 id='volume-method-ls'>Method: <code>ls</code></h2>
<p>[ls sr] returns a list of volumes contained within an attached SR.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SR.ls"</span><span class="p">,</span><span class="w"> </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">volumes</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">ls</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">SR</span><span class="p">.</span><span class="n">ls</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"uri_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"uri_2"</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nl">"physical_utilisation"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"virtual_size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sharable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"read_write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional_uuid"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"uri_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"uri_2"</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nl">"physical_utilisation"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"virtual_size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sharable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"read_write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional_uuid"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">volumes</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">ls</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">SR_myimplementation</span><span class="p">(</span><span class="n">SR_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">):</span>
        <span class="s">"""
        [ls sr] returns a list of volumes contained within an attached SR.
        """</span>
        <span class="k">return</span> <span class="p">[{</span><span class="s">"key"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"uuid"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"name"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"read_write"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"sharable"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"virtual_size"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"physical_utilisation"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"uri"</span><span class="p">:</span> <span class="p">[</span><span class="s">"string"</span><span class="p">],</span> <span class="s">"keys"</span><span class="p">:</span> <span class="p">{</span><span class="s">"string"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">}}]</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>volumes</td>
<td>out</td>
<td>volumes</td>
<td>A list of volumes</td>
</tr>
</tbody></table>
<h2 id='volume-interface-volume'>Interface: <code>Volume</code></h2>
<p>Operations which operate on volumes (also known as  Virtual Disk Images)</p>
<h2 id='volume-method-create'>Method: <code>create</code></h2>
<p>[create sr name description size] creates a new volume in [sr] with  [name] and [description]. The volume will have size &gt;= [size] i.e. it  is always permissable for an implementation to round-up the volume to  the nearest convenient block size</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.create"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"sharable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">13</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">volume</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">create</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">name</span> <span class="n">description</span> <span class="n">size</span> <span class="n">sharable</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">create</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">sharable</span><span class="p">:</span> <span class="bp">True</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"uri_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"uri_2"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"physical_utilisation"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"virtual_size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sharable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"read_write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional_uuid"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">volume</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">create</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">name</span> <span class="n">description</span> <span class="n">size</span> <span class="n">sharable</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">sharable</span><span class="p">):</span>
        <span class="s">"""
        [create sr name description size] creates a new volume in [sr] with
        [name] and [description]. The volume will have size &gt;= [size] i.e. it
        is always permissable for an implementation to round-up the volume to
        the nearest convenient block size
        """</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"uuid"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"name"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"read_write"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"sharable"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"virtual_size"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"physical_utilisation"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"uri"</span><span class="p">:</span> <span class="p">[</span><span class="s">"string"</span><span class="p">],</span> <span class="s">"keys"</span><span class="p">:</span> <span class="p">{</span><span class="s">"string"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">}}</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>name</td>
<td>in</td>
<td>string</td>
<td>A human-readable name to associate with the new disk. This name is  intended to be short, to be a good summary of the disk.</td>
</tr>
<tr>
<td>description</td>
<td>in</td>
<td>string</td>
<td>A human-readable description to associate with the new disk. This can  be arbitrarily long, up to the general string size limit.</td>
</tr>
<tr>
<td>size</td>
<td>in</td>
<td>int64</td>
<td>A minimum size (in bytes) for the disk. Depending on the  characteristics of the implementation this may be rounded up to  (for example) the nearest convenient block size. The created disk  will not be smaller than this size.</td>
</tr>
<tr>
<td>sharable</td>
<td>in</td>
<td>bool</td>
<td>Indicates whether the VDI can be attached by multiple hosts at once. This is used for example by the HA statefile and XAPI redo log.</td>
</tr>
<tr>
<td>volume</td>
<td>out</td>
<td>volume</td>
<td>Properties of the volume</td>
</tr>
</tbody></table>
<h2 id='volume-method-snapshot'>Method: <code>snapshot</code></h2>
<p>[snapshot sr volume] creates a new volue which is a  snapshot of  [volume] in [sr]. Snapshots should never be written to; they are  intended for backup/restore only. Note the name and description are  copied but any extra metadata associated by [set] is not copied. This can raise Activated_on_another_host(host_installation_uuid) if the VDI is already active on another host and snapshots can only be taken on the host that has the VDI active (if any). XAPI will take care of redirecting the request to the proper host</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.snapshot"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">volume</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">snapshot</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">snapshot</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"uri_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"uri_2"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"physical_utilisation"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"virtual_size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sharable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"read_write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional_uuid"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">volume</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">snapshot</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">snapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="s">"""
        [snapshot sr volume] creates a new volue which is a  snapshot of
        [volume] in [sr]. Snapshots should never be written to; they are
        intended for backup/restore only. Note the name and description are
        copied but any extra metadata associated by [set] is not copied.
        This can raise Activated_on_another_host(host_installation_uuid)
        if the VDI is already active on another host and snapshots
        can only be taken on the host that has the VDI active (if any).
        XAPI will take care of redirecting the request to the proper host
        """</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"uuid"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"name"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"read_write"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"sharable"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"virtual_size"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"physical_utilisation"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"uri"</span><span class="p">:</span> <span class="p">[</span><span class="s">"string"</span><span class="p">],</span> <span class="s">"keys"</span><span class="p">:</span> <span class="p">{</span><span class="s">"string"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">}}</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>volume</td>
<td>out</td>
<td>volume</td>
<td>Properties of the volume</td>
</tr>
</tbody></table>
<h2 id='volume-method-clone'>Method: <code>clone</code></h2>
<p>[clone sr volume] creates a new volume which is a writable clone of  [volume] in [sr]. Note the name and description are copied but any  extra metadata associated by [set] is not copied.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.clone"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">volume</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">clone</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">clone</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"uri_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"uri_2"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"physical_utilisation"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"virtual_size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sharable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"read_write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional_uuid"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">volume</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">clone</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="s">"""
        [clone sr volume] creates a new volume which is a writable clone of
        [volume] in [sr]. Note the name and description are copied but any
        extra metadata associated by [set] is not copied.
        """</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"uuid"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"name"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"read_write"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"sharable"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"virtual_size"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"physical_utilisation"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"uri"</span><span class="p">:</span> <span class="p">[</span><span class="s">"string"</span><span class="p">],</span> <span class="s">"keys"</span><span class="p">:</span> <span class="p">{</span><span class="s">"string"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">}}</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>volume</td>
<td>out</td>
<td>volume</td>
<td>Properties of the volume</td>
</tr>
</tbody></table>
<h2 id='volume-method-copy'>Method: <code>copy</code></h2>
<p>[copy sr volume dest_sr] creates a new volume as a writeable copy of  [volume] in [dest_sr]. [dest_sr] may be the same as [sr] and the operation  may be rejected if the volume management plugin cannot copy a volume  between different SRs. It is expected that this operation is accelerated  by the implementation and is more efficient than a blockwise replication  through the local host. This operation should only be called if the plugin  declares the VDI_COPY feature in the query response. If the operation is  rejected then the caller will be expected to fall back to performing a  blockwise copy.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.copy"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"dest_sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dest_sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">volume</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">copy</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">dest_sr</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">copy</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">dest_sr</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"uri_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"uri_2"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"physical_utilisation"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"virtual_size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sharable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"read_write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional_uuid"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">volume</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">copy</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">dest_sr</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">dest_sr</span><span class="p">):</span>
        <span class="s">"""
        [copy sr volume dest_sr] creates a new volume as a writeable copy of
        [volume] in [dest_sr]. [dest_sr] may be the same as [sr] and the operation
        may be rejected if the volume management plugin cannot copy a volume
        between different SRs. It is expected that this operation is accelerated
        by the implementation and is more efficient than a blockwise replication
        through the local host. This operation should only be called if the plugin
        declares the VDI_COPY feature in the query response. If the operation is
        rejected then the caller will be expected to fall back to performing a
        blockwise copy.
        """</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"uuid"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"name"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"read_write"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"sharable"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"virtual_size"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"physical_utilisation"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"uri"</span><span class="p">:</span> <span class="p">[</span><span class="s">"string"</span><span class="p">],</span> <span class="s">"keys"</span><span class="p">:</span> <span class="p">{</span><span class="s">"string"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">}}</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>dest_sr</td>
<td>in</td>
<td>string</td>
<td>The Destination Storage Repository</td>
</tr>
<tr>
<td>volume</td>
<td>out</td>
<td>volume</td>
<td>Properties of the volume</td>
</tr>
</tbody></table>
<h2 id='volume-method-destroy'>Method: <code>destroy</code></h2>
<p>[destroy sr volume] removes [volume] from [sr]</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.destroy"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">destroy</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">destroy</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">destroy</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="s">"""
        [destroy sr volume] removes [volume] from [sr]
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
</tbody></table>
<h2 id='volume-method-set_name'>Method: <code>set_name</code></h2>
<p>[set_name sr volume new_name] changes the name of [volume]</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.set_name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"new_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"new_name"</span><span class="p">,</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">set_name</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">new_name</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">set_name</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">new_name</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">set_name</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">new_name</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">new_name</span><span class="p">):</span>
        <span class="s">"""
        [set_name sr volume new_name] changes the name of [volume]
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>new_name</td>
<td>in</td>
<td>string</td>
<td>New name</td>
</tr>
</tbody></table>
<h2 id='volume-method-set_description'>Method: <code>set_description</code></h2>
<p>[set_description sr volume new_description] changes the description  of [volume]</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.set_description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"new_description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"new_description"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">19</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">set_description</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">new_description</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">set_description</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">new_description</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">set_description</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">new_description</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">set_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">new_description</span><span class="p">):</span>
        <span class="s">"""
        [set_description sr volume new_description] changes the description
        of [volume]
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>new_description</td>
<td>in</td>
<td>string</td>
<td>New description</td>
</tr>
</tbody></table>
<h2 id='volume-method-set'>Method: <code>set</code></h2>
<p>[set sr volume key value] associates [key] with [value] in the  metadata of [volume] Note these keys and values are not interpreted  by the plugin; they are intended for the higher-level software only.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.set"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nl">"v"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v"</span><span class="p">,</span><span class="w"> </span><span class="nl">"k"</span><span class="p">:</span><span class="w"> </span><span class="s2">"k"</span><span class="p">,</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">set</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">k</span> <span class="n">v</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="nb">set</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">set</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">k</span> <span class="n">v</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="s">"""
        [set sr volume key value] associates [key] with [value] in the
        metadata of [volume] Note these keys and values are not interpreted
        by the plugin; they are intended for the higher-level software only.
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>k</td>
<td>in</td>
<td>string</td>
<td>Key</td>
</tr>
<tr>
<td>v</td>
<td>in</td>
<td>string</td>
<td>Value</td>
</tr>
</tbody></table>
<h2 id='volume-method-unset'>Method: <code>unset</code></h2>
<p>[unset sr volume key] removes [key] and any value associated with it  from the metadata of [volume] Note these keys and values are not  interpreted by the plugin; they are intended for the higher-level  software only.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.unset"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"k"</span><span class="p">:</span><span class="w"> </span><span class="s2">"k"</span><span class="p">,</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">unset</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">k</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">unset</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">unset</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">k</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">unset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="s">"""
        [unset sr volume key] removes [key] and any value associated with it
        from the metadata of [volume] Note these keys and values are not
        interpreted by the plugin; they are intended for the higher-level
        software only.
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>k</td>
<td>in</td>
<td>string</td>
<td>Key</td>
</tr>
</tbody></table>
<h2 id='volume-method-resize'>Method: <code>resize</code></h2>
<p>[resize sr volume new_size] enlarges [volume] to be at least  [new_size].</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.resize"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"new_size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">resize</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">new_size</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">resize</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">new_size</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">resize</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">new_size</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">new_size</span><span class="p">):</span>
        <span class="s">"""
        [resize sr volume new_size] enlarges [volume] to be at least
        [new_size].
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>new_size</td>
<td>in</td>
<td>int64</td>
<td>New disk size</td>
</tr>
</tbody></table>
<h2 id='volume-method-stat'>Method: <code>stat</code></h2>
<p>[stat sr volume] returns metadata associated with [volume].</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.stat"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">23</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">volume</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">stat</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">stat</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"field_1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_1"</span><span class="p">,</span><span class="w"> </span><span class="nl">"field_2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"value_2"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"uri_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"uri_2"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"physical_utilisation"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"virtual_size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sharable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"read_write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"optional_uuid"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">volume</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">stat</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="s">"""
        [stat sr volume] returns metadata associated with [volume].
        """</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"key"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"uuid"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span> <span class="s">"name"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"description"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"read_write"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"sharable"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="s">"virtual_size"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"physical_utilisation"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"uri"</span><span class="p">:</span> <span class="p">[</span><span class="s">"string"</span><span class="p">],</span> <span class="s">"keys"</span><span class="p">:</span> <span class="p">{</span><span class="s">"string"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">}}</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>volume</td>
<td>out</td>
<td>volume</td>
<td>Properties of the volume</td>
</tr>
</tbody></table>
<h2 id='volume-method-compare'>Method: <code>compare</code></h2>
<p>[compare sr volume1 volume2] compares the two volumes and returns a  result of type blocklist that describes the differences between the  two volumes. If the two volumes are unrelated, or the second volume  does not exist, the result will be a list of the blocks that are  non-empty in volume1. If this information is not available to the  plugin, it should return a result indicating that all blocks are in  use.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.compare"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key2"</span><span class="p">,</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">24</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">blocklist</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">compare</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">key2</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">compare</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key2</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"ranges"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nl">"blocksize"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">blocklist</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">compare</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">key2</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key2</span><span class="p">):</span>
        <span class="s">"""
        [compare sr volume1 volume2] compares the two volumes and returns a
        result of type blocklist that describes the differences between the
        two volumes. If the two volumes are unrelated, or the second volume
        does not exist, the result will be a list of the blocks that are
        non-empty in volume1. If this information is not available to the
        plugin, it should return a result indicating that all blocks are in
        use.
        """</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"blocksize"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"ranges"</span><span class="p">:</span> <span class="p">[[]]}</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>key2</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>unnamed</td>
<td>out</td>
<td>blocklist</td>
<td>List of blocks for copying.</td>
</tr>
</tbody></table>
<h2 id='volume-method-similar_content'>Method: <code>similar_content</code></h2>
<p>[similar_content sr volume] returns a list of VDIs which have similar content to [vdi]</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.similar_content"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">key</span> <span class="kt">list</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">similar_content</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">similar_content</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"key list_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"key list_2"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">key</span> <span class="kt">list</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">similar_content</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">similar_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="s">"""
        [similar_content sr volume] returns a list of VDIs which have similar
        content to [vdi]
        """</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">"string"</span><span class="p">]</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>key list</td>
<td>out</td>
<td>key_list</td>
<td>List of volume keys</td>
</tr>
</tbody></table>
<h2 id='volume-method-enable_cbt'>Method: <code>enable_cbt</code></h2>
<p>[enable_cbt sr volume] enables Changed Block Tracking for [volume]</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.enable_cbt"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">26</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">enable_cbt</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">enable_cbt</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">enable_cbt</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">enable_cbt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="s">"""
        [enable_cbt sr volume] enables Changed Block Tracking for [volume]
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
</tbody></table>
<h2 id='volume-method-disable_cbt'>Method: <code>disable_cbt</code></h2>
<p>[disable_cbt sr volume] disables Changed Block Tracking for [volume]</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.disable_cbt"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">27</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">disable_cbt</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">disable_cbt</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">disable_cbt</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">disable_cbt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="s">"""
        [disable_cbt sr volume] disables Changed Block Tracking for [volume]
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
</tbody></table>
<h2 id='volume-method-data_destroy'>Method: <code>data_destroy</code></h2>
<p>[data_destroy sr volume] deletes the data of the snapshot [volume] without deleting its changed block tracking metadata</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.data_destroy"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">28</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">data_destroy</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">data_destroy</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">data_destroy</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">data_destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="s">"""
        [data_destroy sr volume] deletes the data of the snapshot [volume]
        without deleting its changed block tracking metadata
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
</tbody></table>
<h2 id='volume-method-list_changed_blocks'>Method: <code>list_changed_blocks</code></h2>
<p>[list_changed_blocks sr volume1 volume2 offset length] returns the blocks that have changed between [volume1] and [volume2] in the extent specified by the given [offset] and [length] as a base64-encoded bitmap string. If this extent is not aligned to the granularity of the returned bitmap, then the bitmap will cover the area extended to the nearest block boundaries.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.list_changed_blocks"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"length"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nl">"offset"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nl">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key2"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">29</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">changed_blocks</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">list_changed_blocks</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">key2</span> <span class="n">offset</span> <span class="n">length</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">list_changed_blocks</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key2</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">length</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"bitmap"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bitmap"</span><span class="p">,</span><span class="w"> </span><span class="nl">"granularity"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">changed_blocks</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">list_changed_blocks</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">key2</span> <span class="n">offset</span> <span class="n">length</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">list_changed_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key2</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="s">"""
        [list_changed_blocks sr volume1 volume2 offset length] returns the
        blocks that have changed between [volume1] and [volume2] in the extent
        specified by the given [offset] and [length] as a base64-encoded
        bitmap string. If this extent is not aligned to the granularity of the
        returned bitmap, then the bitmap will cover the area extended to the
        nearest block boundaries.
        """</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"granularity"</span><span class="p">:</span> <span class="nb">long</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s">"bitmap"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">}</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>key2</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>offset</td>
<td>in</td>
<td>int64</td>
<td>The offset of the extent for which changed blocks should be computed</td>
</tr>
<tr>
<td>length</td>
<td>in</td>
<td>int</td>
<td>The length of the extent for which changed blocks should be computed</td>
</tr>
<tr>
<td>changed_blocks</td>
<td>out</td>
<td>changed_blocks</td>
<td>The changed blocks between two volumes in the specified extent</td>
</tr>
</tbody></table>
<h2 id='volume-method-compose'>Method: <code>compose</code></h2>
<p>[compose sr volume1 volume2] layers the updates from [volume2] onto [volume1], modifying [volume2]. Implementations shall declare the VDI_COMPOSE feature for this method to be supported.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Volume.compose"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"key2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key2"</span><span class="p">,</span><span class="w"> </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="p">,</span><span class="w"> </span><span class="nl">"sr"</span><span class="p">:</span><span class="w"> </span><span class="s2">"sr"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">compose</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">key2</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Volume</span><span class="p">.</span><span class="n">compose</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">sr</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="n">key2</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">compose</span> <span class="n">dbg</span> <span class="n">sr</span> <span class="n">key</span> <span class="n">key2</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Sr_not_attached</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">SR_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Volume_does_not_exist</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Cancelled</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>
<span class="o">|</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Activated_on_another_host</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Volume_myimplementation</span><span class="p">(</span><span class="n">Volume_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">compose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="n">sr</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key2</span><span class="p">):</span>
        <span class="s">"""
        [compose sr volume1 volume2] layers the updates from [volume2] onto
        [volume1], modifying [volume2]. Implementations shall declare the
        VDI_COMPOSE feature for this method to be supported.
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>sr</td>
<td>in</td>
<td>string</td>
<td>The Storage Repository</td>
</tr>
<tr>
<td>key</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
<tr>
<td>key2</td>
<td>in</td>
<td>key</td>
<td>The volume key</td>
</tr>
</tbody></table>
<h2 id='volume-errors'>Errors</h2><h3 id='volume-errors-exns'>exns</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"Sr_not_attached"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exns"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"SR_does_not_exist"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exns"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"Volume_does_not_exist"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exns"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"Unimplemented"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exns"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"Cancelled"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exns"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"Activated_on_another_host"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exns"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>type <code>exns</code> = <code>variant { ... }</code></p>
<h4 id='volume-errors-exns-constructors'>Constructors</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Sr_not_attached</td>
<td>string</td>
<td>An SR must be attached in order to access volumes</td>
</tr>
<tr>
<td>SR_does_not_exist</td>
<td>string</td>
<td>The specified SR could not be found</td>
</tr>
<tr>
<td>Volume_does_not_exist</td>
<td>string</td>
<td>The specified volume could not be found in the SR</td>
</tr>
<tr>
<td>Unimplemented</td>
<td>string</td>
<td>The operation has not been implemented</td>
</tr>
<tr>
<td>Cancelled</td>
<td>string</td>
<td>The operation has been cancelled</td>
</tr>
<tr>
<td>Activated_on_another_host</td>
<td>string</td>
<td>The Volume is already active on another host</td>
</tr>
</tbody></table>
<h3 id='volume-errors-exns'>exns</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"Sr_not_attached"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exns"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"SR_does_not_exist"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exns"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"Volume_does_not_exist"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exns"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"Unimplemented"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exns"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"Cancelled"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exns"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"Activated_on_another_host"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exns"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>type <code>exns</code> = <code>variant { ... }</code></p>
<h4 id='volume-errors-exns-constructors'>Constructors</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Sr_not_attached</td>
<td>string</td>
<td>An SR must be attached in order to access volumes</td>
</tr>
<tr>
<td>SR_does_not_exist</td>
<td>string</td>
<td>The specified SR could not be found</td>
</tr>
<tr>
<td>Volume_does_not_exist</td>
<td>string</td>
<td>The specified volume could not be found in the SR</td>
</tr>
<tr>
<td>Unimplemented</td>
<td>string</td>
<td>The operation has not been implemented</td>
</tr>
<tr>
<td>Cancelled</td>
<td>string</td>
<td>The operation has been cancelled</td>
</tr>
<tr>
<td>Activated_on_another_host</td>
<td>string</td>
<td>The Volume is already active on another host</td>
</tr>
</tbody></table>
<h1 id='task'>task</h1>
<p>The Task interface is required if the backend supports long-running  tasks.</p>
<h2 id='task-type-definitions'>Type definitions</h2><h3 id='task-type-definitions-id'>id</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="s2">"id"</span><span class="w">
</span></code></pre></div>
<p>type <code>id</code> = <code>string</code>
Unique identifier for a task.</p>
<h3 id='task-type-definitions-volume'>volume</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"keys"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"uri"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"physical_utilisation"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"virtual_size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"sharable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"read_write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uuid"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>volume</code> = <code>struct { ... }</code></p>
<h4 id='task-type-definitions-volume-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>key</td>
<td>string</td>
<td>A primary key for this volume. The key must be unique within the enclosing Storage Repository (SR). A typical value would be a filename or an LVM volume name.</td>
</tr>
<tr>
<td>uuid</td>
<td>string option</td>
<td>A uuid (or guid) for the volume, if one is available. If a storage system has a built-in notion of a guid, then it will be returned here.</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>Short, human-readable label for the volume. Names are commonly used by when displaying short lists of volumes.</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>Longer, human-readable description of the volume. Descriptions are generally only displayed by clients when the user is examining volumes individually.</td>
</tr>
<tr>
<td>read_write</td>
<td>bool</td>
<td>True means the VDI may be written to, false means the volume is read-only. Some storage media is read-only so all volumes are read-only; for example .iso disk images on an NFS share. Some volume are created read-only; for example because they are snapshots of some other VDI.</td>
</tr>
<tr>
<td>sharable</td>
<td>bool</td>
<td>Indicates whether the VDI can be attached by multiple hosts at once. This is used for example by the HA statefile and XAPI redo log.</td>
</tr>
<tr>
<td>virtual_size</td>
<td>int64</td>
<td>Size of the volume from the perspective of a VM (in bytes)</td>
</tr>
<tr>
<td>physical_utilisation</td>
<td>int64</td>
<td>Amount of space currently used on the backing storage (in bytes)</td>
</tr>
<tr>
<td>uri</td>
<td>string list</td>
<td>A list of URIs which can be opened and by a datapath plugin for I/O. A URI could reference a local block device, a remote NFS share, iSCSI LUN or RBD volume. In cases where the data may be accessed over several protocols, the list should be sorted into descending order of desirability. Xapi will open the most desirable URI for which it has an available datapath plugin.</td>
</tr>
<tr>
<td>keys</td>
<td>(string * string) list</td>
<td>A list of key=value pairs which have been stored in the Volume metadata. These should not be interpreted by the Volume plugin.</td>
</tr>
</tbody></table>
<h3 id='task-type-definitions-async_result_t'>async_result_t</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="s2">"UnitResult"</span><span class="w">
</span><span class="p">[</span><span class="w">
  </span><span class="s2">"Volume"</span><span class="p">,</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"keys"</span><span class="p">:</span><span class="w"> </span><span class="s2">"keys"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nl">"uri"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"uri"</span><span class="w"> </span><span class="p">],</span><span class="w">
    </span><span class="nl">"physical_utilisation"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"virtual_size"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sharable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"read_write"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"uuid"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"key"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>type <code>async_result_t</code> = <code>variant { ... }</code></p>
<h4 id='task-type-definitions-async_result_t-constructors'>Constructors</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>UnitResult</td>
<td>unit</td>
<td></td>
</tr>
<tr>
<td>Volume</td>
<td>volume</td>
<td></td>
</tr>
</tbody></table>
<h3 id='task-type-definitions-completion_t'>completion_t</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UnitResult"</span><span class="p">,</span><span class="w"> </span><span class="nl">"duration"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>completion_t</code> = <code>struct { ... }</code></p>
<h4 id='task-type-definitions-completion_t-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>duration</td>
<td>float</td>
<td></td>
</tr>
<tr>
<td>result</td>
<td>async_result_t option</td>
<td></td>
</tr>
</tbody></table>
<h3 id='task-type-definitions-state'>state</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"Pending"</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"Completed"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UnitResult"</span><span class="p">,</span><span class="w"> </span><span class="nl">"duration"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[</span><span class="w"> </span><span class="s2">"Failed"</span><span class="p">,</span><span class="w"> </span><span class="s2">"state"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>type <code>state</code> = <code>variant { ... }</code></p>
<h4 id='task-type-definitions-state-constructors'>Constructors</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Pending</td>
<td>float</td>
<td>The task is in progress, with progress info from 0..1.</td>
</tr>
<tr>
<td>Completed</td>
<td>completion_t</td>
<td></td>
</tr>
<tr>
<td>Failed</td>
<td>string</td>
<td></td>
</tr>
</tbody></table>
<h3 id='task-type-definitions-task'>task</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Pending"</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"ctime"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"debug_info"</span><span class="p">:</span><span class="w"> </span><span class="s2">"debug_info"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"id"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>type <code>task</code> = <code>struct { ... }</code></p>
<h4 id='task-type-definitions-task-members'>Members</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>debug_info</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>ctime</td>
<td>float</td>
<td></td>
</tr>
<tr>
<td>state</td>
<td>state</td>
<td></td>
</tr>
</tbody></table>
<h3 id='task-type-definitions-task_list'>task_list</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"task_list"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">[]</span><span class="w">
</span></code></pre></div>
<p>type <code>task_list</code> = <code>string list</code></p>
<h2 id='task-interface-task'>Interface: <code>Task</code></h2>
<p>The task interface is for querying the status of asynchronous  tasks. All long-running operations are associated with tasks,  including copying and mirroring of data.</p>
<h2 id='task-method-stat'>Method: <code>stat</code></h2>
<p>[stat task_id] returns the status of the task</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task.stat"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">44</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">result</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">stat</span> <span class="n">dbg</span> <span class="n">id</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Task</span><span class="p">.</span><span class="n">stat</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"state"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"Pending"</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"ctime"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w">
  </span><span class="nl">"debug_info"</span><span class="p">:</span><span class="w"> </span><span class="s2">"debug_info"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"id"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">result</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">stat</span> <span class="n">dbg</span> <span class="n">id</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Task_myimplementation</span><span class="p">(</span><span class="n">Task_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="s">"""
        [stat task_id] returns the status of the task
        """</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"id"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"debug_info"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="s">"ctime"</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">,</span> <span class="s">"state"</span><span class="p">:</span> <span class="bp">None</span><span class="p">}</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>id</td>
<td>in</td>
<td>id</td>
<td>Unique identifier for a task.</td>
</tr>
<tr>
<td>result</td>
<td>out</td>
<td>task</td>
<td></td>
</tr>
</tbody></table>
<h2 id='task-method-cancel'>Method: <code>cancel</code></h2>
<p>[cancel task_id] performs a best-effort cancellation of an ongoing  task. The effect of this should leave the system in one of two  states: Either that the task has completed successfully, or that it  had never been made at all. The call should return immediately and  the status of the task can the be queried via the [stat] call.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task.cancel"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">45</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">cancel</span> <span class="n">dbg</span> <span class="n">id</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Task</span><span class="p">.</span><span class="n">cancel</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">cancel</span> <span class="n">dbg</span> <span class="n">id</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Task_myimplementation</span><span class="p">(</span><span class="n">Task_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="s">"""
        [cancel task_id] performs a best-effort cancellation of an ongoing
        task. The effect of this should leave the system in one of two
        states: Either that the task has completed successfully, or that it
        had never been made at all. The call should return immediately and
        the status of the task can the be queried via the [stat] call.
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>id</td>
<td>in</td>
<td>id</td>
<td>Unique identifier for a task.</td>
</tr>
</tbody></table>
<h2 id='task-method-destroy'>Method: <code>destroy</code></h2>
<p>[destroy task_id] should remove all traces of the task_id. This call  should fail if the task is currently in progress.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task.destroy"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">46</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">destroy</span> <span class="n">dbg</span> <span class="n">id</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Task</span><span class="p">.</span><span class="n">destroy</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="kc">null</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="bp">()</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">destroy</span> <span class="n">dbg</span> <span class="n">id</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Task_myimplementation</span><span class="p">(</span><span class="n">Task_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="s">"""
        [destroy task_id] should remove all traces of the task_id. This call
        should fail if the task is currently in progress.
        """</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>id</td>
<td>in</td>
<td>id</td>
<td>Unique identifier for a task.</td>
</tr>
</tbody></table>
<h2 id='task-method-ls'>Method: <code>ls</code></h2>
<p>[ls] should return a list of all of the tasks the plugin is aware of.</p>

<blockquote>
<p>Client</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w"> </span><span class="nl">"method"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Task.ls"</span><span class="p">,</span><span class="w"> </span><span class="nl">"params"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"dbg"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dbg"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">47</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">task_list</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">ls</span> <span class="n">dbg</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import necessary libraries if needed
# we assume that your library providing the client is called myclient and it provides a connect method
</span><span class="kn">import</span> <span class="nn">myclient</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">myclient</span><span class="p">.</span><span class="n">connect</span><span class="p">()</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">Task</span><span class="p">.</span><span class="n">ls</span><span class="p">({</span> <span class="n">dbg</span><span class="p">:</span> <span class="s">"string"</span> <span class="p">})</span>
    <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
</code></pre></div>
<blockquote>
<p>Server</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"task_list_1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"task_list_2"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div><div class="highlight"><pre class="highlight ocaml tab-ocaml"><code><span class="k">try</span>
    <span class="k">let</span> <span class="n">task_list</span> <span class="o">=</span> <span class="nn">Client</span><span class="p">.</span><span class="n">ls</span> <span class="n">dbg</span> <span class="k">in</span>
    <span class="o">...</span>
<span class="k">with</span> <span class="nc">Exn</span> <span class="p">(</span><span class="nc">Unimplemented</span> <span class="n">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="o">...</span>

</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>
<span class="c1"># import additional libraries if needed
</span>
<span class="k">class</span> <span class="nc">Task_myimplementation</span><span class="p">(</span><span class="n">Task_skeleton</span><span class="p">):</span>
    <span class="c1"># by default each method will return a Not_implemented error
</span>    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">ls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dbg</span><span class="p">):</span>
        <span class="s">"""
        [ls] should return a list of all of the tasks the plugin is aware of.
        """</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">"string"</span><span class="p">]</span>
    <span class="c1"># ...
</span></code></pre></div>
<table><thead>
<tr>
<th>Name</th>
<th>Direction</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>dbg</td>
<td>in</td>
<td>string</td>
<td>Debug context from the caller</td>
</tr>
<tr>
<td>unnamed</td>
<td>out</td>
<td>task_list</td>
<td></td>
</tr>
</tbody></table>
<h2 id='task-errors'>Errors</h2><h3 id='task-errors-exnt'>exnt</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"Unimplemented"</span><span class="p">,</span><span class="w"> </span><span class="s2">"exnt"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>type <code>exnt</code> = <code>variant { ... }</code></p>
<h4 id='task-errors-exnt-constructors'>Constructors</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Unimplemented</td>
<td>string</td>
<td></td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="json">json</a>
                <a href="#" data-language-name="ocaml">ocaml</a>
                <a href="#" data-language-name="python">python</a>
          </div>
      </div>
    </div>
  </body>
</html>
